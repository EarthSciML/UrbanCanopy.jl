<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Albedos and Radiative Fluxes · UrbanCanopy.jl</title><meta name="title" content="Albedos and Radiative Fluxes · UrbanCanopy.jl"/><meta property="og:title" content="Albedos and Radiative Fluxes · UrbanCanopy.jl"/><meta property="twitter:title" content="Albedos and Radiative Fluxes · UrbanCanopy.jl"/><meta name="description" content="Documentation for UrbanCanopy.jl."/><meta property="og:description" content="Documentation for UrbanCanopy.jl."/><meta property="twitter:description" content="Documentation for UrbanCanopy.jl."/><meta property="og:url" content="https://urbancanopy.earthsci.dev/albedos_radiative_fluxes/"/><meta property="twitter:url" content="https://urbancanopy.earthsci.dev/albedos_radiative_fluxes/"/><link rel="canonical" href="https://urbancanopy.earthsci.dev/albedos_radiative_fluxes/"/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">UrbanCanopy.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../clmu_introduction/">CLMU Introduction</a></li><li class="is-active"><a class="tocitem" href>Albedos and Radiative Fluxes</a><ul class="internal"><li><a class="tocitem" href="#Overview"><span>Overview</span></a></li><li><a class="tocitem" href="#Implementation"><span>Implementation</span></a></li><li><a class="tocitem" href="#Analysis"><span>Analysis</span></a></li></ul></li><li><a class="tocitem" href="../api/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Albedos and Radiative Fluxes</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Albedos and Radiative Fluxes</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/EarthSciML/UrbanCanopy.jl/blob/main/docs/src/albedos_radiative_fluxes.md#" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Albedos-and-Radiative-Fluxes"><a class="docs-heading-anchor" href="#Albedos-and-Radiative-Fluxes">Albedos and Radiative Fluxes</a><a id="Albedos-and-Radiative-Fluxes-1"></a><a class="docs-heading-anchor-permalink" href="#Albedos-and-Radiative-Fluxes" title="Permalink"></a></h1><h2 id="Overview"><a class="docs-heading-anchor" href="#Overview">Overview</a><a id="Overview-1"></a><a class="docs-heading-anchor-permalink" href="#Overview" title="Permalink"></a></h2><p>Chapter 2 of the CLMU technical note describes the computation of albedos and radiative fluxes for urban surfaces. The effects of canyon geometry on the radiation balance are a key driver of urban-rural energy balance differences (Oke et al. 1991). Shadowing of urban surfaces affects incident radiation and thus temperature, and multiple reflections of radiation between canyon surfaces must be accounted for (Harman et al. 2004).</p><p>The <code>UrbanRadiation</code> component computes:</p><ol><li><strong>View factors</strong> between canyon surfaces (road, walls, sky) as functions of the height-to-width ratio <span>$H/W$</span> (Eqs. 2.22-2.28)</li><li><strong>Incident direct beam solar radiation</strong> on walls and road, integrated over canyon orientations (Eqs. 2.11-2.17)</li><li><strong>Incident diffuse solar radiation</strong> on canyon surfaces (Eqs. 2.29-2.32)</li><li><strong>Absorbed and reflected solar radiation</strong> with closed-form multi-reflection solution (Eqs. 2.34-2.95)</li><li><strong>Longwave radiation</strong> including emission, reflection, and multi-reflection within the canyon (Eqs. 2.96-2.175)</li></ol><p>The iterative multi-reflection scheme from the paper (Eqs. 2.63-2.85 for solar, 2.138-2.170 for longwave) is solved in closed form using the matrix geometric series: <span>$S_{absorbed} = (I - A)(I - TA)^{-1} S_0$</span>, where <span>$A$</span> is the albedo matrix, <span>$T$</span> is the view-factor transport matrix, and <span>$S_0$</span> is the initial incident radiation vector. The 3x3 matrix inverse is computed analytically.</p><p><strong>Reference</strong>: Oleson, K.W., G.B. Bonan, J.J. Feddema, M. Vertenstein, and E. Kluzek, 2010: Technical Description of an Urban Parameterization for the Community Land Model (CLMU). NCAR Technical Note NCAR/TN-480+STR, National Center for Atmospheric Research, Boulder, CO, 168 pp. Chapter 2: Albedos and Radiative Fluxes (pp. 26-60).</p><article><details class="docstring" open="true"><summary id="UrbanCanopy.UrbanRadiation"><a class="docstring-binding" href="#UrbanCanopy.UrbanRadiation"><code>UrbanCanopy.UrbanRadiation</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">UrbanRadiation(; name=:UrbanRadiation)</code></pre><p>Urban albedos and radiative fluxes for the Community Land Model Urban (CLMU) parameterization, following Chapter 2 of Oleson et al. (2010).</p><p>Computes the view factors, incident direct beam and diffuse solar radiation, absorbed and reflected solar radiation (with closed-form multi-reflection solution for the urban canyon), incident longwave radiation, and absorbed/reflected/emitted longwave radiation for urban surfaces: roof, sunlit wall, shaded wall, and road.</p><p>The urban canyon is represented as an infinitely long canyon of width W bordered by buildings of height H. Radiation interactions within the canyon account for multiple reflections between walls and road using view factors. The iterative multi-reflection scheme (Eqs. 2.63-2.85, 2.138-2.170) is solved in closed form using the matrix geometric series: <code>S_absorbed = (I - A) * (I - T*A)^{-1} * S_0</code>, where A is the albedo matrix, T is the view-factor transport matrix, and S_0 is the initial incident radiation vector.</p><p><strong>Reference</strong>: Oleson, K.W., G.B. Bonan, J.J. Feddema, M. Vertenstein, and E. Kluzek, 2010: Technical Description of an Urban Parameterization for the Community Land Model (CLMU). NCAR Technical Note NCAR/TN-480+STR, National Center for Atmospheric Research, Boulder, CO, 168 pp. Chapter 2: Albedos and Radiative Fluxes (pp. 26-60).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/EarthSciML/UrbanCanopy.jl/blob/78c59739c93328d53b20ff4569915428ea6e3da0/src/albedos_radiative_fluxes.jl#L3-L26">source</a></section></details></article><h2 id="Implementation"><a class="docs-heading-anchor" href="#Implementation">Implementation</a><a id="Implementation-1"></a><a class="docs-heading-anchor-permalink" href="#Implementation" title="Permalink"></a></h2><p>The <code>UrbanRadiation</code> component implements the radiation balance for the urban canyon system with 62 equations, 62 variables, and 31 parameters.</p><h3 id="State-Variables"><a class="docs-heading-anchor" href="#State-Variables">State Variables</a><a id="State-Variables-1"></a><a class="docs-heading-anchor-permalink" href="#State-Variables" title="Permalink"></a></h3><pre><code class="language-julia hljs">using DataFrames, ModelingToolkit, Symbolics, DynamicQuantities
using UrbanCanopy

sys = UrbanRadiation()

vars = unknowns(sys)
DataFrame(
    :Name =&gt; [string(Symbolics.tosymbol(v, escape = false)) for v in vars],
    :Units =&gt; [dimension(ModelingToolkit.get_unit(v)) for v in vars],
    :Description =&gt; [ModelingToolkit.getdescription(v) for v in vars]
)</code></pre><div><div style = "float: left;"><span>62×3 DataFrame</span></div><div style = "clear: both;"></div></div><div class = "data-frame" style = "overflow-x: scroll;"><table class = "data-frame" style = "margin-bottom: 6px;"><thead><tr class = "columnLabelRow"><th class = "stubheadLabel" style = "font-weight: bold; text-align: right;">Row</th><th style = "text-align: left;">Name</th><th style = "text-align: left;">Units</th><th style = "text-align: left;">Description</th></tr><tr class = "columnLabelRow"><th class = "stubheadLabel" style = "font-weight: bold; text-align: right;"></th><th title = "String" style = "text-align: left;">String</th><th title = "DynamicQuantities.Dimensions{DynamicQuantities.FRInt32}" style = "text-align: left;">Dimensio…</th><th title = "String" style = "text-align: left;">String</th></tr></thead><tbody><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">1</td><td style = "text-align: left;">Ψ_sky_wall</td><td style = "text-align: left;"></td><td style = "text-align: left;">View factor: sky to wall (Eq. 2.24) (dimensionless)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">2</td><td style = "text-align: left;">Ψ_wall_sky</td><td style = "text-align: left;"></td><td style = "text-align: left;">View factor: wall to sky (Eq. 2.24) (dimensionless)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">3</td><td style = "text-align: left;">Ψ_road_sky</td><td style = "text-align: left;"></td><td style = "text-align: left;">View factor: road to sky (Eq. 2.25) (dimensionless)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">4</td><td style = "text-align: left;">Ψ_sky_road</td><td style = "text-align: left;"></td><td style = "text-align: left;">View factor: sky to road (Eq. 2.25) (dimensionless)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">5</td><td style = "text-align: left;">Ψ_wall_road</td><td style = "text-align: left;"></td><td style = "text-align: left;">View factor: wall to road (Eq. 2.26) (dimensionless)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">6</td><td style = "text-align: left;">Ψ_road_wall</td><td style = "text-align: left;"></td><td style = "text-align: left;">View factor: road to wall (Eq. 2.27) (dimensionless)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">7</td><td style = "text-align: left;">Ψ_wall_wall</td><td style = "text-align: left;"></td><td style = "text-align: left;">View factor: wall to wall (Eq. 2.28) (dimensionless)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">8</td><td style = "text-align: left;">T_rw</td><td style = "text-align: left;"></td><td style = "text-align: left;">Transport: wall to road = H/W * Ψ_wall_road (dimensionless)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">9</td><td style = "text-align: left;">T_wr</td><td style = "text-align: left;"></td><td style = "text-align: left;">Transport: road to wall = Ψ_road_wall / (H/W) (dimensionless)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">10</td><td style = "text-align: left;">T_ww</td><td style = "text-align: left;"></td><td style = "text-align: left;">Transport: wall to wall = Ψ_wall_wall (dimensionless)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">11</td><td style = "text-align: left;">θ_0</td><td style = "text-align: left;"></td><td style = "text-align: left;">Critical canyon orientation angle (Eq. 2.11)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">12</td><td style = "text-align: left;">S_sunwall_factor</td><td style = "text-align: left;"></td><td style = "text-align: left;">Sunlit wall direct beam factor (Eq. 2.16) (dimensionless)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">13</td><td style = "text-align: left;">S_sunwall_dir_vis</td><td style = "text-align: left;">kg s⁻³</td><td style = "text-align: left;">Direct beam VIS on sunlit wall (Eq. 2.16)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">14</td><td style = "text-align: left;">S_sunwall_dir_nir</td><td style = "text-align: left;">kg s⁻³</td><td style = "text-align: left;">Direct beam NIR on sunlit wall</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">15</td><td style = "text-align: left;">S_road_factor</td><td style = "text-align: left;"></td><td style = "text-align: left;">Road direct beam factor (Eq. 2.17) (dimensionless)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">16</td><td style = "text-align: left;">S_road_dir_vis</td><td style = "text-align: left;">kg s⁻³</td><td style = "text-align: left;">Direct beam VIS on road (Eq. 2.17)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">17</td><td style = "text-align: left;">S_road_dir_nir</td><td style = "text-align: left;">kg s⁻³</td><td style = "text-align: left;">Direct beam NIR on road</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">18</td><td style = "text-align: left;">S_road_dif_vis</td><td style = "text-align: left;">kg s⁻³</td><td style = "text-align: left;">Diffuse VIS on road (Eq. 2.30)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">19</td><td style = "text-align: left;">S_road_dif_nir</td><td style = "text-align: left;">kg s⁻³</td><td style = "text-align: left;">Diffuse NIR on road</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">20</td><td style = "text-align: left;">S_wall_dif_vis</td><td style = "text-align: left;">kg s⁻³</td><td style = "text-align: left;">Diffuse VIS on wall (Eq. 2.31-2.32)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">21</td><td style = "text-align: left;">S_wall_dif_nir</td><td style = "text-align: left;">kg s⁻³</td><td style = "text-align: left;">Diffuse NIR on wall</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">22</td><td style = "text-align: left;">S_net_roof</td><td style = "text-align: left;">kg s⁻³</td><td style = "text-align: left;">Net absorbed solar by roof (Eqs. 2.34-2.35)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">23</td><td style = "text-align: left;">det_dir_vis</td><td style = "text-align: left;"></td><td style = "text-align: left;">Determinant of (I-TA), direct beam VIS (dimensionless)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">24</td><td style = "text-align: left;">S_net_road_dir_vis</td><td style = "text-align: left;">kg s⁻³</td><td style = "text-align: left;">Absorbed solar: road, direct VIS</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">25</td><td style = "text-align: left;">S_net_sunwall_dir_vis</td><td style = "text-align: left;">kg s⁻³</td><td style = "text-align: left;">Absorbed solar: sunwall, direct VIS</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">26</td><td style = "text-align: left;">S_net_shdwall_dir_vis</td><td style = "text-align: left;">kg s⁻³</td><td style = "text-align: left;">Absorbed solar: shdwall, direct VIS</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">27</td><td style = "text-align: left;">S_refl_sky_dir_vis</td><td style = "text-align: left;">kg s⁻³</td><td style = "text-align: left;">Reflected to sky: direct VIS</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">28</td><td style = "text-align: left;">det_dir_nir</td><td style = "text-align: left;"></td><td style = "text-align: left;">Determinant of (I-TA), direct beam NIR (dimensionless)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">29</td><td style = "text-align: left;">S_net_road_dir_nir</td><td style = "text-align: left;">kg s⁻³</td><td style = "text-align: left;">Absorbed solar: road, direct NIR</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">30</td><td style = "text-align: left;">S_net_sunwall_dir_nir</td><td style = "text-align: left;">kg s⁻³</td><td style = "text-align: left;">Absorbed solar: sunwall, direct NIR</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">31</td><td style = "text-align: left;">S_net_shdwall_dir_nir</td><td style = "text-align: left;">kg s⁻³</td><td style = "text-align: left;">Absorbed solar: shdwall, direct NIR</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">32</td><td style = "text-align: left;">S_refl_sky_dir_nir</td><td style = "text-align: left;">kg s⁻³</td><td style = "text-align: left;">Reflected to sky: direct NIR</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">33</td><td style = "text-align: left;">det_dif_vis</td><td style = "text-align: left;"></td><td style = "text-align: left;">Determinant of (I-TA), diffuse VIS (dimensionless)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">34</td><td style = "text-align: left;">S_net_road_dif_vis</td><td style = "text-align: left;">kg s⁻³</td><td style = "text-align: left;">Absorbed solar: road, diffuse VIS</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">35</td><td style = "text-align: left;">S_net_sunwall_dif_vis</td><td style = "text-align: left;">kg s⁻³</td><td style = "text-align: left;">Absorbed solar: sunwall, diffuse VIS</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">36</td><td style = "text-align: left;">S_net_shdwall_dif_vis</td><td style = "text-align: left;">kg s⁻³</td><td style = "text-align: left;">Absorbed solar: shdwall, diffuse VIS</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">37</td><td style = "text-align: left;">S_refl_sky_dif_vis</td><td style = "text-align: left;">kg s⁻³</td><td style = "text-align: left;">Reflected to sky: diffuse VIS</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">38</td><td style = "text-align: left;">det_dif_nir</td><td style = "text-align: left;"></td><td style = "text-align: left;">Determinant of (I-TA), diffuse NIR (dimensionless)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">39</td><td style = "text-align: left;">S_net_road_dif_nir</td><td style = "text-align: left;">kg s⁻³</td><td style = "text-align: left;">Absorbed solar: road, diffuse NIR</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">40</td><td style = "text-align: left;">S_net_sunwall_dif_nir</td><td style = "text-align: left;">kg s⁻³</td><td style = "text-align: left;">Absorbed solar: sunwall, diffuse NIR</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">41</td><td style = "text-align: left;">S_net_shdwall_dif_nir</td><td style = "text-align: left;">kg s⁻³</td><td style = "text-align: left;">Absorbed solar: shdwall, diffuse NIR</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">42</td><td style = "text-align: left;">S_refl_sky_dif_nir</td><td style = "text-align: left;">kg s⁻³</td><td style = "text-align: left;">Reflected to sky: diffuse NIR</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">43</td><td style = "text-align: left;">S_net_road</td><td style = "text-align: left;">kg s⁻³</td><td style = "text-align: left;">Total net absorbed solar by road</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">44</td><td style = "text-align: left;">S_net_sunwall</td><td style = "text-align: left;">kg s⁻³</td><td style = "text-align: left;">Total net absorbed solar by sunlit wall per wall area</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">45</td><td style = "text-align: left;">S_net_shdwall</td><td style = "text-align: left;">kg s⁻³</td><td style = "text-align: left;">Total net absorbed solar by shaded wall per wall area</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">46</td><td style = "text-align: left;">S_net_uc</td><td style = "text-align: left;">kg s⁻³</td><td style = "text-align: left;">Net absorbed solar by urban canyon per ground area</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">47</td><td style = "text-align: left;">α_uc_dir_vis</td><td style = "text-align: left;"></td><td style = "text-align: left;">Canyon direct beam albedo, VIS (Eq. 2.93) (dimensionless)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">48</td><td style = "text-align: left;">α_uc_dir_nir</td><td style = "text-align: left;"></td><td style = "text-align: left;">Canyon direct beam albedo, NIR (dimensionless)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">49</td><td style = "text-align: left;">α_uc_dif_vis</td><td style = "text-align: left;"></td><td style = "text-align: left;">Canyon diffuse albedo, VIS (Eq. 2.94) (dimensionless)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">50</td><td style = "text-align: left;">α_uc_dif_nir</td><td style = "text-align: left;"></td><td style = "text-align: left;">Canyon diffuse albedo, NIR (dimensionless)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">51</td><td style = "text-align: left;">S_net_total</td><td style = "text-align: left;">kg s⁻³</td><td style = "text-align: left;">Total net absorbed solar (Eq. 2.95)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">52</td><td style = "text-align: left;">L_up_roof</td><td style = "text-align: left;">kg s⁻³</td><td style = "text-align: left;">Upward LW from roof (Eq. 2.102)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">53</td><td style = "text-align: left;">L_net_roof</td><td style = "text-align: left;">kg s⁻³</td><td style = "text-align: left;">Net LW for roof (Eq. 2.101)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">54</td><td style = "text-align: left;">L_emit_road</td><td style = "text-align: left;">kg s⁻³</td><td style = "text-align: left;">Emitted LW from road (Eq. 2.111)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">55</td><td style = "text-align: left;">L_emit_sunwall</td><td style = "text-align: left;">kg s⁻³</td><td style = "text-align: left;">Emitted LW from sunlit wall (Eq. 2.112)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">56</td><td style = "text-align: left;">L_emit_shdwall</td><td style = "text-align: left;">kg s⁻³</td><td style = "text-align: left;">Emitted LW from shaded wall (Eq. 2.113)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">57</td><td style = "text-align: left;">det_lw</td><td style = "text-align: left;"></td><td style = "text-align: left;">Determinant of (I-TA) for longwave (dimensionless)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">58</td><td style = "text-align: left;">L_net_road</td><td style = "text-align: left;">kg s⁻³</td><td style = "text-align: left;">Net LW for road</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">59</td><td style = "text-align: left;">L_net_sunwall</td><td style = "text-align: left;">kg s⁻³</td><td style = "text-align: left;">Net LW for sunlit wall per wall area</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">60</td><td style = "text-align: left;">L_net_shdwall</td><td style = "text-align: left;">kg s⁻³</td><td style = "text-align: left;">Net LW for shaded wall per wall area</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">61</td><td style = "text-align: left;">L_net_uc</td><td style = "text-align: left;">kg s⁻³</td><td style = "text-align: left;">Net LW for urban canyon per ground area (Eq. 2.172)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">62</td><td style = "text-align: left;">L_net_total</td><td style = "text-align: left;">kg s⁻³</td><td style = "text-align: left;">Total net LW (Eq. 2.175)</td></tr></tbody></table></div><h3 id="Parameters"><a class="docs-heading-anchor" href="#Parameters">Parameters</a><a id="Parameters-1"></a><a class="docs-heading-anchor-permalink" href="#Parameters" title="Permalink"></a></h3><pre><code class="language-julia hljs">params = parameters(sys)
DataFrame(
    :Name =&gt; [string(Symbolics.tosymbol(p, escape = false)) for p in params],
    :Units =&gt; [dimension(ModelingToolkit.get_unit(p)) for p in params],
    :Description =&gt; [ModelingToolkit.getdescription(p) for p in params]
)</code></pre><div><div style = "float: left;"><span>31×3 DataFrame</span></div><div style = "clear: both;"></div></div><div class = "data-frame" style = "overflow-x: scroll;"><table class = "data-frame" style = "margin-bottom: 6px;"><thead><tr class = "columnLabelRow"><th class = "stubheadLabel" style = "font-weight: bold; text-align: right;">Row</th><th style = "text-align: left;">Name</th><th style = "text-align: left;">Units</th><th style = "text-align: left;">Description</th></tr><tr class = "columnLabelRow"><th class = "stubheadLabel" style = "font-weight: bold; text-align: right;"></th><th title = "String" style = "text-align: left;">String</th><th title = "DynamicQuantities.Dimensions{DynamicQuantities.FRInt32}" style = "text-align: left;">Dimensio…</th><th title = "String" style = "text-align: left;">String</th></tr></thead><tbody><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">1</td><td style = "text-align: left;">S_atm_dir_vis</td><td style = "text-align: left;">kg s⁻³</td><td style = "text-align: left;">Incident direct beam visible solar radiation</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">2</td><td style = "text-align: left;">α_roof_dif_nir</td><td style = "text-align: left;"></td><td style = "text-align: left;">Roof albedo, diffuse, NIR (dimensionless)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">3</td><td style = "text-align: left;">α_road_dir_nir</td><td style = "text-align: left;"></td><td style = "text-align: left;">Effective road albedo, direct beam, NIR (dimensionless)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">4</td><td style = "text-align: left;">μ_zen</td><td style = "text-align: left;"></td><td style = "text-align: left;">Solar zenith angle</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">5</td><td style = "text-align: left;">α_road_dif_vis</td><td style = "text-align: left;"></td><td style = "text-align: left;">Effective road albedo, diffuse, visible (dimensionless)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">6</td><td style = "text-align: left;">α_roof_dir_vis</td><td style = "text-align: left;"></td><td style = "text-align: left;">Roof albedo, direct beam, visible (dimensionless)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">7</td><td style = "text-align: left;">zero_wm2</td><td style = "text-align: left;">kg s⁻³</td><td style = "text-align: left;">Zero radiative flux</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">8</td><td style = "text-align: left;">T_shdwall</td><td style = "text-align: left;">K</td><td style = "text-align: left;">Shaded wall surface temperature</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">9</td><td style = "text-align: left;">T_road</td><td style = "text-align: left;">K</td><td style = "text-align: left;">Road surface temperature</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">10</td><td style = "text-align: left;">W_roof</td><td style = "text-align: left;"></td><td style = "text-align: left;">Roof fraction of urban surface (dimensionless)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">11</td><td style = "text-align: left;">π_val</td><td style = "text-align: left;"></td><td style = "text-align: left;">Pi (dimensionless)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">12</td><td style = "text-align: left;">H_W</td><td style = "text-align: left;"></td><td style = "text-align: left;">Canyon height to width ratio H/W (dimensionless)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">13</td><td style = "text-align: left;">ε_roof</td><td style = "text-align: left;"></td><td style = "text-align: left;">Roof emissivity (dimensionless)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">14</td><td style = "text-align: left;">ε_road</td><td style = "text-align: left;"></td><td style = "text-align: left;">Effective road emissivity (dimensionless)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">15</td><td style = "text-align: left;">α_road_dir_vis</td><td style = "text-align: left;"></td><td style = "text-align: left;">Effective road albedo, direct beam, visible (dimensionless)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">16</td><td style = "text-align: left;">S_atm_dif_nir</td><td style = "text-align: left;">kg s⁻³</td><td style = "text-align: left;">Incident diffuse NIR solar radiation</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">17</td><td style = "text-align: left;">α_wall_dir_vis</td><td style = "text-align: left;"></td><td style = "text-align: left;">Wall albedo, direct beam, visible (dimensionless)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">18</td><td style = "text-align: left;">S_atm_dif_vis</td><td style = "text-align: left;">kg s⁻³</td><td style = "text-align: left;">Incident diffuse visible solar radiation</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">19</td><td style = "text-align: left;">L_atm_down</td><td style = "text-align: left;">kg s⁻³</td><td style = "text-align: left;">Incident longwave radiation from atmosphere</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">20</td><td style = "text-align: left;">α_roof_dif_vis</td><td style = "text-align: left;"></td><td style = "text-align: left;">Roof albedo, diffuse, visible (dimensionless)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">21</td><td style = "text-align: left;">α_wall_dif_nir</td><td style = "text-align: left;"></td><td style = "text-align: left;">Wall albedo, diffuse, NIR (dimensionless)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">22</td><td style = "text-align: left;">S_atm_dir_nir</td><td style = "text-align: left;">kg s⁻³</td><td style = "text-align: left;">Incident direct beam NIR solar radiation</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">23</td><td style = "text-align: left;">α_wall_dif_vis</td><td style = "text-align: left;"></td><td style = "text-align: left;">Wall albedo, diffuse, visible (dimensionless)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">24</td><td style = "text-align: left;">T_roof</td><td style = "text-align: left;">K</td><td style = "text-align: left;">Roof surface temperature</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">25</td><td style = "text-align: left;">ε_wall</td><td style = "text-align: left;"></td><td style = "text-align: left;">Wall emissivity (dimensionless)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">26</td><td style = "text-align: left;">α_roof_dir_nir</td><td style = "text-align: left;"></td><td style = "text-align: left;">Roof albedo, direct beam, NIR (dimensionless)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">27</td><td style = "text-align: left;">T_sunwall</td><td style = "text-align: left;">K</td><td style = "text-align: left;">Sunlit wall surface temperature</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">28</td><td style = "text-align: left;">α_wall_dir_nir</td><td style = "text-align: left;"></td><td style = "text-align: left;">Wall albedo, direct beam, NIR (dimensionless)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">29</td><td style = "text-align: left;">α_road_dif_nir</td><td style = "text-align: left;"></td><td style = "text-align: left;">Effective road albedo, diffuse, NIR (dimensionless)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">30</td><td style = "text-align: left;">one_rad</td><td style = "text-align: left;"></td><td style = "text-align: left;">Unit angle for non-dimensionalization</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">31</td><td style = "text-align: left;">σ_SB</td><td style = "text-align: left;">kg s⁻³ K⁻⁴</td><td style = "text-align: left;">Stefan-Boltzmann constant (Table 1.4)</td></tr></tbody></table></div><h3 id="Equations"><a class="docs-heading-anchor" href="#Equations">Equations</a><a id="Equations-1"></a><a class="docs-heading-anchor-permalink" href="#Equations" title="Permalink"></a></h3><pre><code class="language-julia hljs">eqs = equations(sys)</code></pre><p class="math-container">\[ \begin{align}
\mathtt{\Psi\_sky\_wall}\left( t \right) &amp;= \frac{1 + \mathtt{H\_W} - \sqrt{1 + \mathtt{H\_W}^{2}}}{2 \mathtt{H\_W}} \\
\mathtt{\Psi\_wall\_sky}\left( t \right) &amp;= \mathtt{\Psi\_sky\_wall}\left( t \right) \\
\mathtt{\Psi\_road\_sky}\left( t \right) &amp;=  - \mathtt{H\_W} + \sqrt{1 + \mathtt{H\_W}^{2}} \\
\mathtt{\Psi\_sky\_road}\left( t \right) &amp;= \mathtt{\Psi\_road\_sky}\left( t \right) \\
\mathtt{\Psi\_wall\_road}\left( t \right) &amp;= \mathtt{\Psi\_wall\_sky}\left( t \right) \\
\mathtt{\Psi\_road\_wall}\left( t \right) &amp;= \frac{1}{2} \left( 1 - \mathtt{\Psi\_road\_sky}\left( t \right) \right) \\
\mathtt{\Psi\_wall\_wall}\left( t \right) &amp;= 1 - \mathtt{\Psi\_wall\_sky}\left( t \right) - \mathtt{\Psi\_wall\_road}\left( t \right) \\
\mathtt{T\_rw}\left( t \right) &amp;= \mathtt{H\_W} \mathtt{\Psi\_wall\_road}\left( t \right) \\
\mathtt{T\_wr}\left( t \right) &amp;= \frac{\mathtt{\Psi\_road\_wall}\left( t \right)}{\mathtt{H\_W}} \\
\mathtt{T\_ww}\left( t \right) &amp;= \mathtt{\Psi\_wall\_wall}\left( t \right) \\
\mathtt{\theta\_0}\left( t \right) &amp;= \mathtt{one\_rad} \arcsin\left( min\left( \frac{1}{\mathtt{H\_W} \tan\left( \frac{\mathtt{\mu\_zen}}{\mathtt{one\_rad}} \right)}, 1 \right) \right) \\
\mathtt{S\_sunwall\_factor}\left( t \right) &amp;= 2 \left( \frac{\tan\left( \frac{\mathtt{\mu\_zen}}{\mathtt{one\_rad}} \right) \left( 1 - \cos\left( \frac{\mathtt{\theta\_0}\left( t \right)}{\mathtt{one\_rad}} \right) \right)}{\mathtt{\pi\_val}} + \frac{0.5 + \frac{ - \mathtt{\theta\_0}\left( t \right)}{\mathtt{one\_rad} \mathtt{\pi\_val}}}{\mathtt{H\_W}} \right) \\
\mathtt{S\_sunwall\_dir\_vis}\left( t \right) &amp;= \mathtt{S\_atm\_dir\_vis} \mathtt{S\_sunwall\_factor}\left( t \right) \\
\mathtt{S\_sunwall\_dir\_nir}\left( t \right) &amp;= \mathtt{S\_atm\_dir\_nir} \mathtt{S\_sunwall\_factor}\left( t \right) \\
\mathtt{S\_road\_factor}\left( t \right) &amp;= \frac{ - 2 \mathtt{H\_W} \tan\left( \frac{\mathtt{\mu\_zen}}{\mathtt{one\_rad}} \right) \left( 1 - \cos\left( \frac{\mathtt{\theta\_0}\left( t \right)}{\mathtt{one\_rad}} \right) \right)}{\mathtt{\pi\_val}} + \frac{2 \mathtt{\theta\_0}\left( t \right)}{\mathtt{one\_rad} \mathtt{\pi\_val}} \\
\mathtt{S\_road\_dir\_vis}\left( t \right) &amp;= \mathtt{S\_atm\_dir\_vis} \mathtt{S\_road\_factor}\left( t \right) \\
\mathtt{S\_road\_dir\_nir}\left( t \right) &amp;= \mathtt{S\_atm\_dir\_nir} \mathtt{S\_road\_factor}\left( t \right) \\
\mathtt{S\_road\_dif\_vis}\left( t \right) &amp;= \mathtt{S\_atm\_dif\_vis} \mathtt{\Psi\_sky\_road}\left( t \right) \\
\mathtt{S\_road\_dif\_nir}\left( t \right) &amp;= \mathtt{S\_atm\_dif\_nir} \mathtt{\Psi\_sky\_road}\left( t \right) \\
\mathtt{S\_wall\_dif\_vis}\left( t \right) &amp;= \mathtt{S\_atm\_dif\_vis} \mathtt{\Psi\_sky\_wall}\left( t \right) \\
\mathtt{S\_wall\_dif\_nir}\left( t \right) &amp;= \mathtt{S\_atm\_dif\_nir} \mathtt{\Psi\_sky\_wall}\left( t \right) \\
\mathtt{S\_net\_roof}\left( t \right) &amp;= \mathtt{S\_atm\_dif\_nir} \left( 1 - \mathtt{\alpha\_roof\_dif\_nir} \right) + \mathtt{S\_atm\_dif\_vis} \left( 1 - \mathtt{\alpha\_roof\_dif\_vis} \right) + \mathtt{S\_atm\_dir\_nir} \left( 1 - \mathtt{\alpha\_roof\_dir\_nir} \right) + \mathtt{S\_atm\_dir\_vis} \left( 1 - \mathtt{\alpha\_roof\_dir\_vis} \right) \\
\mathtt{det\_dir\_vis}\left( t \right) &amp;= 1 - \mathtt{\alpha\_wall\_dir\_vis}^{2} \left( \mathtt{T\_ww}\left( t \right) \right)^{2} - 2 \mathtt{T\_wr}\left( t \right) \mathtt{T\_rw}\left( t \right) \left( 1 + \mathtt{T\_ww}\left( t \right) \mathtt{\alpha\_wall\_dir\_vis} \right) \mathtt{\alpha\_road\_dir\_vis} \mathtt{\alpha\_wall\_dir\_vis} \\
\mathtt{S\_net\_road\_dir\_vis}\left( t \right) &amp;= \frac{\left( \mathtt{zero\_wm2} \mathtt{T\_rw}\left( t \right) \left( 1 + \mathtt{T\_ww}\left( t \right) \mathtt{\alpha\_wall\_dir\_vis} \right) \mathtt{\alpha\_wall\_dir\_vis} + \mathtt{S\_road\_dir\_vis}\left( t \right) \left( 1 - \mathtt{\alpha\_wall\_dir\_vis}^{2} \left( \mathtt{T\_ww}\left( t \right) \right)^{2} \right) + \mathtt{T\_rw}\left( t \right) \mathtt{S\_sunwall\_dir\_vis}\left( t \right) \left( 1 + \mathtt{T\_ww}\left( t \right) \mathtt{\alpha\_wall\_dir\_vis} \right) \mathtt{\alpha\_wall\_dir\_vis} \right) \left( 1 - \mathtt{\alpha\_road\_dir\_vis} \right)}{\mathtt{det\_dir\_vis}\left( t \right)} \\
\mathtt{S\_net\_sunwall\_dir\_vis}\left( t \right) &amp;= \frac{\left( \mathtt{zero\_wm2} \left( \mathtt{T\_ww}\left( t \right) \mathtt{\alpha\_wall\_dir\_vis} + \mathtt{T\_wr}\left( t \right) \mathtt{T\_rw}\left( t \right) \mathtt{\alpha\_road\_dir\_vis} \mathtt{\alpha\_wall\_dir\_vis} \right) + \mathtt{T\_wr}\left( t \right) \mathtt{S\_road\_dir\_vis}\left( t \right) \left( 1 + \mathtt{T\_ww}\left( t \right) \mathtt{\alpha\_wall\_dir\_vis} \right) \mathtt{\alpha\_road\_dir\_vis} + \left( 1 - \mathtt{T\_wr}\left( t \right) \mathtt{T\_rw}\left( t \right) \mathtt{\alpha\_road\_dir\_vis} \mathtt{\alpha\_wall\_dir\_vis} \right) \mathtt{S\_sunwall\_dir\_vis}\left( t \right) \right) \left( 1 - \mathtt{\alpha\_wall\_dir\_vis} \right)}{\mathtt{det\_dir\_vis}\left( t \right)} \\
\mathtt{S\_net\_shdwall\_dir\_vis}\left( t \right) &amp;= \frac{\left( \mathtt{zero\_wm2} \left( 1 - \mathtt{T\_wr}\left( t \right) \mathtt{T\_rw}\left( t \right) \mathtt{\alpha\_road\_dir\_vis} \mathtt{\alpha\_wall\_dir\_vis} \right) + \mathtt{T\_wr}\left( t \right) \mathtt{S\_road\_dir\_vis}\left( t \right) \left( 1 + \mathtt{T\_ww}\left( t \right) \mathtt{\alpha\_wall\_dir\_vis} \right) \mathtt{\alpha\_road\_dir\_vis} + \left( \mathtt{T\_ww}\left( t \right) \mathtt{\alpha\_wall\_dir\_vis} + \mathtt{T\_wr}\left( t \right) \mathtt{T\_rw}\left( t \right) \mathtt{\alpha\_road\_dir\_vis} \mathtt{\alpha\_wall\_dir\_vis} \right) \mathtt{S\_sunwall\_dir\_vis}\left( t \right) \right) \left( 1 - \mathtt{\alpha\_wall\_dir\_vis} \right)}{\mathtt{det\_dir\_vis}\left( t \right)} \\
\mathtt{S\_refl\_sky\_dir\_vis}\left( t \right) &amp;=  - \mathtt{S\_net\_road\_dir\_vis}\left( t \right) + \mathtt{S\_road\_dir\_vis}\left( t \right) + \mathtt{H\_W} \left( \mathtt{zero\_wm2} + \mathtt{S\_sunwall\_dir\_vis}\left( t \right) \right) - \mathtt{H\_W} \left( \mathtt{S\_net\_sunwall\_dir\_vis}\left( t \right) + \mathtt{S\_net\_shdwall\_dir\_vis}\left( t \right) \right) \\
\mathtt{det\_dir\_nir}\left( t \right) &amp;= 1 - \mathtt{\alpha\_wall\_dir\_nir}^{2} \left( \mathtt{T\_ww}\left( t \right) \right)^{2} - 2 \mathtt{T\_wr}\left( t \right) \mathtt{T\_rw}\left( t \right) \left( 1 + \mathtt{T\_ww}\left( t \right) \mathtt{\alpha\_wall\_dir\_nir} \right) \mathtt{\alpha\_road\_dir\_nir} \mathtt{\alpha\_wall\_dir\_nir} \\
\mathtt{S\_net\_road\_dir\_nir}\left( t \right) &amp;= \frac{\left( \mathtt{zero\_wm2} \mathtt{T\_rw}\left( t \right) \left( 1 + \mathtt{T\_ww}\left( t \right) \mathtt{\alpha\_wall\_dir\_nir} \right) \mathtt{\alpha\_wall\_dir\_nir} + \mathtt{S\_road\_dir\_nir}\left( t \right) \left( 1 - \mathtt{\alpha\_wall\_dir\_nir}^{2} \left( \mathtt{T\_ww}\left( t \right) \right)^{2} \right) + \mathtt{S\_sunwall\_dir\_nir}\left( t \right) \mathtt{T\_rw}\left( t \right) \left( 1 + \mathtt{T\_ww}\left( t \right) \mathtt{\alpha\_wall\_dir\_nir} \right) \mathtt{\alpha\_wall\_dir\_nir} \right) \left( 1 - \mathtt{\alpha\_road\_dir\_nir} \right)}{\mathtt{det\_dir\_nir}\left( t \right)} \\
\mathtt{S\_net\_sunwall\_dir\_nir}\left( t \right) &amp;= \frac{\left( \mathtt{zero\_wm2} \left( \mathtt{T\_ww}\left( t \right) \mathtt{\alpha\_wall\_dir\_nir} + \mathtt{T\_wr}\left( t \right) \mathtt{T\_rw}\left( t \right) \mathtt{\alpha\_road\_dir\_nir} \mathtt{\alpha\_wall\_dir\_nir} \right) + \mathtt{T\_wr}\left( t \right) \mathtt{S\_road\_dir\_nir}\left( t \right) \left( 1 + \mathtt{T\_ww}\left( t \right) \mathtt{\alpha\_wall\_dir\_nir} \right) \mathtt{\alpha\_road\_dir\_nir} + \left( 1 - \mathtt{T\_wr}\left( t \right) \mathtt{T\_rw}\left( t \right) \mathtt{\alpha\_road\_dir\_nir} \mathtt{\alpha\_wall\_dir\_nir} \right) \mathtt{S\_sunwall\_dir\_nir}\left( t \right) \right) \left( 1 - \mathtt{\alpha\_wall\_dir\_nir} \right)}{\mathtt{det\_dir\_nir}\left( t \right)} \\
\mathtt{S\_net\_shdwall\_dir\_nir}\left( t \right) &amp;= \frac{\left( \mathtt{zero\_wm2} \left( 1 - \mathtt{T\_wr}\left( t \right) \mathtt{T\_rw}\left( t \right) \mathtt{\alpha\_road\_dir\_nir} \mathtt{\alpha\_wall\_dir\_nir} \right) + \mathtt{T\_wr}\left( t \right) \mathtt{S\_road\_dir\_nir}\left( t \right) \left( 1 + \mathtt{T\_ww}\left( t \right) \mathtt{\alpha\_wall\_dir\_nir} \right) \mathtt{\alpha\_road\_dir\_nir} + \left( \mathtt{T\_ww}\left( t \right) \mathtt{\alpha\_wall\_dir\_nir} + \mathtt{T\_wr}\left( t \right) \mathtt{T\_rw}\left( t \right) \mathtt{\alpha\_road\_dir\_nir} \mathtt{\alpha\_wall\_dir\_nir} \right) \mathtt{S\_sunwall\_dir\_nir}\left( t \right) \right) \left( 1 - \mathtt{\alpha\_wall\_dir\_nir} \right)}{\mathtt{det\_dir\_nir}\left( t \right)} \\
\mathtt{S\_refl\_sky\_dir\_nir}\left( t \right) &amp;= \mathtt{S\_road\_dir\_nir}\left( t \right) - \mathtt{S\_net\_road\_dir\_nir}\left( t \right) + \mathtt{H\_W} \left( \mathtt{zero\_wm2} + \mathtt{S\_sunwall\_dir\_nir}\left( t \right) \right) - \mathtt{H\_W} \left( \mathtt{S\_net\_sunwall\_dir\_nir}\left( t \right) + \mathtt{S\_net\_shdwall\_dir\_nir}\left( t \right) \right) \\
\mathtt{det\_dif\_vis}\left( t \right) &amp;= 1 - \mathtt{\alpha\_wall\_dif\_vis}^{2} \left( \mathtt{T\_ww}\left( t \right) \right)^{2} - 2 \mathtt{T\_wr}\left( t \right) \mathtt{T\_rw}\left( t \right) \left( 1 + \mathtt{T\_ww}\left( t \right) \mathtt{\alpha\_wall\_dif\_vis} \right) \mathtt{\alpha\_road\_dif\_vis} \mathtt{\alpha\_wall\_dif\_vis} \\
\mathtt{S\_net\_road\_dif\_vis}\left( t \right) &amp;= \frac{\left( \mathtt{S\_road\_dif\_vis}\left( t \right) \left( 1 - \mathtt{\alpha\_wall\_dif\_vis}^{2} \left( \mathtt{T\_ww}\left( t \right) \right)^{2} \right) + 2 \mathtt{S\_wall\_dif\_vis}\left( t \right) \mathtt{T\_rw}\left( t \right) \left( 1 + \mathtt{T\_ww}\left( t \right) \mathtt{\alpha\_wall\_dif\_vis} \right) \mathtt{\alpha\_wall\_dif\_vis} \right) \left( 1 - \mathtt{\alpha\_road\_dif\_vis} \right)}{\mathtt{det\_dif\_vis}\left( t \right)} \\
\mathtt{S\_net\_sunwall\_dif\_vis}\left( t \right) &amp;= \frac{\left( \mathtt{T\_wr}\left( t \right) \mathtt{S\_road\_dif\_vis}\left( t \right) \left( 1 + \mathtt{T\_ww}\left( t \right) \mathtt{\alpha\_wall\_dif\_vis} \right) \mathtt{\alpha\_road\_dif\_vis} + \left( 1 - \mathtt{T\_wr}\left( t \right) \mathtt{T\_rw}\left( t \right) \mathtt{\alpha\_road\_dif\_vis} \mathtt{\alpha\_wall\_dif\_vis} \right) \mathtt{S\_wall\_dif\_vis}\left( t \right) + \left( \mathtt{T\_ww}\left( t \right) \mathtt{\alpha\_wall\_dif\_vis} + \mathtt{T\_wr}\left( t \right) \mathtt{T\_rw}\left( t \right) \mathtt{\alpha\_road\_dif\_vis} \mathtt{\alpha\_wall\_dif\_vis} \right) \mathtt{S\_wall\_dif\_vis}\left( t \right) \right) \left( 1 - \mathtt{\alpha\_wall\_dif\_vis} \right)}{\mathtt{det\_dif\_vis}\left( t \right)} \\
\mathtt{S\_net\_shdwall\_dif\_vis}\left( t \right) &amp;= \frac{\left( \mathtt{T\_wr}\left( t \right) \mathtt{S\_road\_dif\_vis}\left( t \right) \left( 1 + \mathtt{T\_ww}\left( t \right) \mathtt{\alpha\_wall\_dif\_vis} \right) \mathtt{\alpha\_road\_dif\_vis} + \left( 1 - \mathtt{T\_wr}\left( t \right) \mathtt{T\_rw}\left( t \right) \mathtt{\alpha\_road\_dif\_vis} \mathtt{\alpha\_wall\_dif\_vis} \right) \mathtt{S\_wall\_dif\_vis}\left( t \right) + \left( \mathtt{T\_ww}\left( t \right) \mathtt{\alpha\_wall\_dif\_vis} + \mathtt{T\_wr}\left( t \right) \mathtt{T\_rw}\left( t \right) \mathtt{\alpha\_road\_dif\_vis} \mathtt{\alpha\_wall\_dif\_vis} \right) \mathtt{S\_wall\_dif\_vis}\left( t \right) \right) \left( 1 - \mathtt{\alpha\_wall\_dif\_vis} \right)}{\mathtt{det\_dif\_vis}\left( t \right)} \\
\mathtt{S\_refl\_sky\_dif\_vis}\left( t \right) &amp;= \mathtt{S\_road\_dif\_vis}\left( t \right) - \mathtt{S\_net\_road\_dif\_vis}\left( t \right) - \mathtt{H\_W} \left( \mathtt{S\_net\_shdwall\_dif\_vis}\left( t \right) + \mathtt{S\_net\_sunwall\_dif\_vis}\left( t \right) \right) + 2 \mathtt{H\_W} \mathtt{S\_wall\_dif\_vis}\left( t \right) \\
\mathtt{det\_dif\_nir}\left( t \right) &amp;= 1 - \mathtt{\alpha\_wall\_dif\_nir}^{2} \left( \mathtt{T\_ww}\left( t \right) \right)^{2} - 2 \mathtt{T\_wr}\left( t \right) \mathtt{T\_rw}\left( t \right) \left( 1 + \mathtt{T\_ww}\left( t \right) \mathtt{\alpha\_wall\_dif\_nir} \right) \mathtt{\alpha\_road\_dif\_nir} \mathtt{\alpha\_wall\_dif\_nir} \\
\mathtt{S\_net\_road\_dif\_nir}\left( t \right) &amp;= \frac{\left( \mathtt{S\_road\_dif\_nir}\left( t \right) \left( 1 - \mathtt{\alpha\_wall\_dif\_nir}^{2} \left( \mathtt{T\_ww}\left( t \right) \right)^{2} \right) + 2 \mathtt{T\_rw}\left( t \right) \mathtt{S\_wall\_dif\_nir}\left( t \right) \left( 1 + \mathtt{T\_ww}\left( t \right) \mathtt{\alpha\_wall\_dif\_nir} \right) \mathtt{\alpha\_wall\_dif\_nir} \right) \left( 1 - \mathtt{\alpha\_road\_dif\_nir} \right)}{\mathtt{det\_dif\_nir}\left( t \right)} \\
\mathtt{S\_net\_sunwall\_dif\_nir}\left( t \right) &amp;= \frac{\left( \mathtt{T\_wr}\left( t \right) \mathtt{S\_road\_dif\_nir}\left( t \right) \left( 1 + \mathtt{T\_ww}\left( t \right) \mathtt{\alpha\_wall\_dif\_nir} \right) \mathtt{\alpha\_road\_dif\_nir} + \left( 1 - \mathtt{T\_wr}\left( t \right) \mathtt{T\_rw}\left( t \right) \mathtt{\alpha\_road\_dif\_nir} \mathtt{\alpha\_wall\_dif\_nir} \right) \mathtt{S\_wall\_dif\_nir}\left( t \right) + \left( \mathtt{T\_ww}\left( t \right) \mathtt{\alpha\_wall\_dif\_nir} + \mathtt{T\_wr}\left( t \right) \mathtt{T\_rw}\left( t \right) \mathtt{\alpha\_road\_dif\_nir} \mathtt{\alpha\_wall\_dif\_nir} \right) \mathtt{S\_wall\_dif\_nir}\left( t \right) \right) \left( 1 - \mathtt{\alpha\_wall\_dif\_nir} \right)}{\mathtt{det\_dif\_nir}\left( t \right)} \\
\mathtt{S\_net\_shdwall\_dif\_nir}\left( t \right) &amp;= \frac{\left( \mathtt{T\_wr}\left( t \right) \mathtt{S\_road\_dif\_nir}\left( t \right) \left( 1 + \mathtt{T\_ww}\left( t \right) \mathtt{\alpha\_wall\_dif\_nir} \right) \mathtt{\alpha\_road\_dif\_nir} + \left( 1 - \mathtt{T\_wr}\left( t \right) \mathtt{T\_rw}\left( t \right) \mathtt{\alpha\_road\_dif\_nir} \mathtt{\alpha\_wall\_dif\_nir} \right) \mathtt{S\_wall\_dif\_nir}\left( t \right) + \left( \mathtt{T\_ww}\left( t \right) \mathtt{\alpha\_wall\_dif\_nir} + \mathtt{T\_wr}\left( t \right) \mathtt{T\_rw}\left( t \right) \mathtt{\alpha\_road\_dif\_nir} \mathtt{\alpha\_wall\_dif\_nir} \right) \mathtt{S\_wall\_dif\_nir}\left( t \right) \right) \left( 1 - \mathtt{\alpha\_wall\_dif\_nir} \right)}{\mathtt{det\_dif\_nir}\left( t \right)} \\
\mathtt{S\_refl\_sky\_dif\_nir}\left( t \right) &amp;= \mathtt{S\_road\_dif\_nir}\left( t \right) - \mathtt{S\_net\_road\_dif\_nir}\left( t \right) - \mathtt{H\_W} \left( \mathtt{S\_net\_shdwall\_dif\_nir}\left( t \right) + \mathtt{S\_net\_sunwall\_dif\_nir}\left( t \right) \right) + 2 \mathtt{H\_W} \mathtt{S\_wall\_dif\_nir}\left( t \right) \\
\mathtt{S\_net\_road}\left( t \right) &amp;= \mathtt{S\_net\_road\_dir\_vis}\left( t \right) + \mathtt{S\_net\_road\_dif\_vis}\left( t \right) + \mathtt{S\_net\_road\_dif\_nir}\left( t \right) + \mathtt{S\_net\_road\_dir\_nir}\left( t \right) \\
\mathtt{S\_net\_sunwall}\left( t \right) &amp;= \mathtt{S\_net\_sunwall\_dir\_nir}\left( t \right) + \mathtt{S\_net\_sunwall\_dif\_nir}\left( t \right) + \mathtt{S\_net\_sunwall\_dir\_vis}\left( t \right) + \mathtt{S\_net\_sunwall\_dif\_vis}\left( t \right) \\
\mathtt{S\_net\_shdwall}\left( t \right) &amp;= \mathtt{S\_net\_shdwall\_dif\_nir}\left( t \right) + \mathtt{S\_net\_shdwall\_dif\_vis}\left( t \right) + \mathtt{S\_net\_shdwall\_dir\_nir}\left( t \right) + \mathtt{S\_net\_shdwall\_dir\_vis}\left( t \right) \\
\mathtt{S\_net\_uc}\left( t \right) &amp;= \mathtt{S\_net\_road}\left( t \right) + \mathtt{H\_W} \left( \mathtt{S\_net\_sunwall}\left( t \right) + \mathtt{S\_net\_shdwall}\left( t \right) \right) \\
\mathtt{\alpha\_uc\_dir\_vis}\left( t \right) &amp;= ifelse\left( \mathtt{S\_road\_dir\_vis}\left( t \right) + \mathtt{H\_W} \mathtt{S\_sunwall\_dir\_vis}\left( t \right) &gt; \mathtt{zero\_wm2}, \frac{\mathtt{S\_refl\_sky\_dir\_vis}\left( t \right)}{\mathtt{S\_road\_dir\_vis}\left( t \right) + \mathtt{H\_W} \mathtt{S\_sunwall\_dir\_vis}\left( t \right)}, 0 \right) \\
\mathtt{\alpha\_uc\_dir\_nir}\left( t \right) &amp;= ifelse\left( \mathtt{S\_road\_dir\_nir}\left( t \right) + \mathtt{H\_W} \mathtt{S\_sunwall\_dir\_nir}\left( t \right) &gt; \mathtt{zero\_wm2}, \frac{\mathtt{S\_refl\_sky\_dir\_nir}\left( t \right)}{\mathtt{S\_road\_dir\_nir}\left( t \right) + \mathtt{H\_W} \mathtt{S\_sunwall\_dir\_nir}\left( t \right)}, 0 \right) \\
\mathtt{\alpha\_uc\_dif\_vis}\left( t \right) &amp;= ifelse\left( \mathtt{S\_road\_dif\_vis}\left( t \right) + 2 \mathtt{H\_W} \mathtt{S\_wall\_dif\_vis}\left( t \right) &gt; \mathtt{zero\_wm2}, \frac{\mathtt{S\_refl\_sky\_dif\_vis}\left( t \right)}{\mathtt{S\_road\_dif\_vis}\left( t \right) + 2 \mathtt{H\_W} \mathtt{S\_wall\_dif\_vis}\left( t \right)}, 0 \right) \\
\mathtt{\alpha\_uc\_dif\_nir}\left( t \right) &amp;= ifelse\left( \mathtt{S\_road\_dif\_nir}\left( t \right) + 2 \mathtt{H\_W} \mathtt{S\_wall\_dif\_nir}\left( t \right) &gt; \mathtt{zero\_wm2}, \frac{\mathtt{S\_refl\_sky\_dif\_nir}\left( t \right)}{\mathtt{S\_road\_dif\_nir}\left( t \right) + 2 \mathtt{H\_W} \mathtt{S\_wall\_dif\_nir}\left( t \right)}, 0 \right) \\
\mathtt{S\_net\_total}\left( t \right) &amp;= \left( 1 - \mathtt{W\_roof} \right) \mathtt{S\_net\_uc}\left( t \right) + \mathtt{W\_roof} \mathtt{S\_net\_roof}\left( t \right) \\
\mathtt{L\_up\_roof}\left( t \right) &amp;= \mathtt{L\_atm\_down} \left( 1 - \mathtt{\varepsilon\_roof} \right) + \mathtt{T\_roof}^{4} \mathtt{\varepsilon\_roof} \mathtt{\sigma\_SB} \\
\mathtt{L\_net\_roof}\left( t \right) &amp;=  - \mathtt{L\_atm\_down} + \mathtt{L\_up\_roof}\left( t \right) \\
\mathtt{L\_emit\_road}\left( t \right) &amp;= \mathtt{T\_road}^{4} \mathtt{\varepsilon\_road} \mathtt{\sigma\_SB} \\
\mathtt{L\_emit\_sunwall}\left( t \right) &amp;= \mathtt{T\_sunwall}^{4} \mathtt{\varepsilon\_wall} \mathtt{\sigma\_SB} \\
\mathtt{L\_emit\_shdwall}\left( t \right) &amp;= \mathtt{T\_shdwall}^{4} \mathtt{\varepsilon\_wall} \mathtt{\sigma\_SB} \\
\mathtt{det\_lw}\left( t \right) &amp;= 1 - \left( 1 - \mathtt{\varepsilon\_wall} \right)^{2} \left( \mathtt{T\_ww}\left( t \right) \right)^{2} - 2 \mathtt{T\_wr}\left( t \right) \mathtt{T\_rw}\left( t \right) \left( 1 + \mathtt{T\_ww}\left( t \right) \left( 1 - \mathtt{\varepsilon\_wall} \right) \right) \left( 1 - \mathtt{\varepsilon\_road} \right) \left( 1 - \mathtt{\varepsilon\_wall} \right) \\
\mathtt{L\_net\_road}\left( t \right) &amp;= \frac{ - \left( \left( \mathtt{L\_atm\_down} \mathtt{\Psi\_sky\_wall}\left( t \right) + \mathtt{T\_wr}\left( t \right) \mathtt{L\_emit\_road}\left( t \right) + \mathtt{L\_emit\_shdwall}\left( t \right) \mathtt{T\_ww}\left( t \right) \right) \mathtt{T\_rw}\left( t \right) \left( 1 + \mathtt{T\_ww}\left( t \right) \left( 1 - \mathtt{\varepsilon\_wall} \right) \right) \left( 1 - \mathtt{\varepsilon\_wall} \right) + \left( \mathtt{L\_atm\_down} \mathtt{\Psi\_sky\_wall}\left( t \right) + \mathtt{T\_wr}\left( t \right) \mathtt{L\_emit\_road}\left( t \right) + \mathtt{L\_emit\_sunwall}\left( t \right) \mathtt{T\_ww}\left( t \right) \right) \mathtt{T\_rw}\left( t \right) \left( 1 + \mathtt{T\_ww}\left( t \right) \left( 1 - \mathtt{\varepsilon\_wall} \right) \right) \left( 1 - \mathtt{\varepsilon\_wall} \right) + \left( \mathtt{L\_atm\_down} \mathtt{\Psi\_sky\_road}\left( t \right) + \mathtt{T\_rw}\left( t \right) \left( \mathtt{L\_emit\_sunwall}\left( t \right) + \mathtt{L\_emit\_shdwall}\left( t \right) \right) \right) \left( 1 - \left( 1 - \mathtt{\varepsilon\_wall} \right)^{2} \left( \mathtt{T\_ww}\left( t \right) \right)^{2} \right) \right) \mathtt{\varepsilon\_road}}{\mathtt{det\_lw}\left( t \right)} + \mathtt{L\_emit\_road}\left( t \right) \\
\mathtt{L\_net\_sunwall}\left( t \right) &amp;= \mathtt{L\_emit\_sunwall}\left( t \right) + \frac{ - \left( \left( \mathtt{L\_atm\_down} \mathtt{\Psi\_sky\_wall}\left( t \right) + \mathtt{T\_wr}\left( t \right) \mathtt{L\_emit\_road}\left( t \right) + \mathtt{L\_emit\_sunwall}\left( t \right) \mathtt{T\_ww}\left( t \right) \right) \left( \mathtt{T\_ww}\left( t \right) \left( 1 - \mathtt{\varepsilon\_wall} \right) + \mathtt{T\_wr}\left( t \right) \mathtt{T\_rw}\left( t \right) \left( 1 - \mathtt{\varepsilon\_road} \right) \left( 1 - \mathtt{\varepsilon\_wall} \right) \right) + \left( \mathtt{L\_atm\_down} \mathtt{\Psi\_sky\_wall}\left( t \right) + \mathtt{T\_wr}\left( t \right) \mathtt{L\_emit\_road}\left( t \right) + \mathtt{L\_emit\_shdwall}\left( t \right) \mathtt{T\_ww}\left( t \right) \right) \left( 1 - \mathtt{T\_wr}\left( t \right) \mathtt{T\_rw}\left( t \right) \left( 1 - \mathtt{\varepsilon\_road} \right) \left( 1 - \mathtt{\varepsilon\_wall} \right) \right) + \left( \mathtt{L\_atm\_down} \mathtt{\Psi\_sky\_road}\left( t \right) + \mathtt{T\_rw}\left( t \right) \left( \mathtt{L\_emit\_sunwall}\left( t \right) + \mathtt{L\_emit\_shdwall}\left( t \right) \right) \right) \mathtt{T\_wr}\left( t \right) \left( 1 + \mathtt{T\_ww}\left( t \right) \left( 1 - \mathtt{\varepsilon\_wall} \right) \right) \left( 1 - \mathtt{\varepsilon\_road} \right) \right) \mathtt{\varepsilon\_wall}}{\mathtt{det\_lw}\left( t \right)} \\
\mathtt{L\_net\_shdwall}\left( t \right) &amp;= \frac{ - \left( \left( \mathtt{L\_atm\_down} \mathtt{\Psi\_sky\_wall}\left( t \right) + \mathtt{T\_wr}\left( t \right) \mathtt{L\_emit\_road}\left( t \right) + \mathtt{L\_emit\_sunwall}\left( t \right) \mathtt{T\_ww}\left( t \right) \right) \left( 1 - \mathtt{T\_wr}\left( t \right) \mathtt{T\_rw}\left( t \right) \left( 1 - \mathtt{\varepsilon\_road} \right) \left( 1 - \mathtt{\varepsilon\_wall} \right) \right) + \left( \mathtt{L\_atm\_down} \mathtt{\Psi\_sky\_wall}\left( t \right) + \mathtt{T\_wr}\left( t \right) \mathtt{L\_emit\_road}\left( t \right) + \mathtt{L\_emit\_shdwall}\left( t \right) \mathtt{T\_ww}\left( t \right) \right) \left( \mathtt{T\_ww}\left( t \right) \left( 1 - \mathtt{\varepsilon\_wall} \right) + \mathtt{T\_wr}\left( t \right) \mathtt{T\_rw}\left( t \right) \left( 1 - \mathtt{\varepsilon\_road} \right) \left( 1 - \mathtt{\varepsilon\_wall} \right) \right) + \left( \mathtt{L\_atm\_down} \mathtt{\Psi\_sky\_road}\left( t \right) + \mathtt{T\_rw}\left( t \right) \left( \mathtt{L\_emit\_sunwall}\left( t \right) + \mathtt{L\_emit\_shdwall}\left( t \right) \right) \right) \mathtt{T\_wr}\left( t \right) \left( 1 + \mathtt{T\_ww}\left( t \right) \left( 1 - \mathtt{\varepsilon\_wall} \right) \right) \left( 1 - \mathtt{\varepsilon\_road} \right) \right) \mathtt{\varepsilon\_wall}}{\mathtt{det\_lw}\left( t \right)} + \mathtt{L\_emit\_shdwall}\left( t \right) \\
\mathtt{L\_net\_uc}\left( t \right) &amp;= \mathtt{L\_net\_road}\left( t \right) + \mathtt{H\_W} \left( \mathtt{L\_net\_shdwall}\left( t \right) + \mathtt{L\_net\_sunwall}\left( t \right) \right) \\
\mathtt{L\_net\_total}\left( t \right) &amp;= \mathtt{W\_roof} \mathtt{L\_net\_roof}\left( t \right) + \left( 1 - \mathtt{W\_roof} \right) \mathtt{L\_net\_uc}\left( t \right)
\end{align}
 \]</p><h2 id="Analysis"><a class="docs-heading-anchor" href="#Analysis">Analysis</a><a id="Analysis-1"></a><a class="docs-heading-anchor-permalink" href="#Analysis" title="Permalink"></a></h2><p>The following figures reproduce the key results from Chapter 2 of the CLMU technical note using the implementation above.</p><pre><code class="language-julia hljs">using OrdinaryDiffEqDefault
using Plots

compiled = mtkcompile(sys)

function solve_urban(compiled, params)
    prob = ODEProblem(compiled, params, (0.0, 1.0))
    solve(prob)
end

function base_params(compiled; H_W=1.0, μ_zen=0.5236)
    Dict(
        compiled.H_W =&gt; H_W,
        compiled.W_roof =&gt; 0.25,
        compiled.S_atm_dir_vis =&gt; 200.0,
        compiled.S_atm_dir_nir =&gt; 200.0,
        compiled.S_atm_dif_vis =&gt; 100.0,
        compiled.S_atm_dif_nir =&gt; 100.0,
        compiled.L_atm_down =&gt; 340.0,
        compiled.μ_zen =&gt; μ_zen,
        compiled.α_roof_dir_vis =&gt; 0.15,
        compiled.α_roof_dir_nir =&gt; 0.15,
        compiled.α_roof_dif_vis =&gt; 0.15,
        compiled.α_roof_dif_nir =&gt; 0.15,
        compiled.α_road_dir_vis =&gt; 0.08,
        compiled.α_road_dir_nir =&gt; 0.08,
        compiled.α_road_dif_vis =&gt; 0.08,
        compiled.α_road_dif_nir =&gt; 0.08,
        compiled.α_wall_dir_vis =&gt; 0.25,
        compiled.α_wall_dir_nir =&gt; 0.25,
        compiled.α_wall_dif_vis =&gt; 0.25,
        compiled.α_wall_dif_nir =&gt; 0.25,
        compiled.ε_roof =&gt; 0.90,
        compiled.ε_road =&gt; 0.95,
        compiled.ε_wall =&gt; 0.85,
        compiled.T_roof =&gt; 292.16,
        compiled.T_road =&gt; 292.16,
        compiled.T_sunwall =&gt; 292.16,
        compiled.T_shdwall =&gt; 292.16,
    )
end</code></pre><h3 id="Figure-2.4:-View-Factors-vs-Canyon-H/W-Ratio"><a class="docs-heading-anchor" href="#Figure-2.4:-View-Factors-vs-Canyon-H/W-Ratio">Figure 2.4: View Factors vs Canyon H/W Ratio</a><a id="Figure-2.4:-View-Factors-vs-Canyon-H/W-Ratio-1"></a><a class="docs-heading-anchor-permalink" href="#Figure-2.4:-View-Factors-vs-Canyon-H/W-Ratio" title="Permalink"></a></h3><p>View factors as a function of canyon height to width ratio (cf. Figure 2.4, p. 37). <span>$\Psi_{road-sky}$</span> is the fraction of radiation reaching the sky from the road, <span>$\Psi_{road-wall}$</span> is the fraction reaching the wall from the road, <span>$\Psi_{wall-sky}$</span> and <span>$\Psi_{wall-road}$</span> are the fractions reaching the sky and road from the wall, and <span>$\Psi_{wall-wall}$</span> is the fraction reaching the opposite wall.</p><pre><code class="language-julia hljs">hw_range = 10 .^ range(-2, 1, length=200)

ψ_road_sky = Float64[]
ψ_road_wall = Float64[]
ψ_wall_sky = Float64[]
ψ_wall_road = Float64[]
ψ_wall_wall = Float64[]

for hw in hw_range
    p = base_params(compiled; H_W=hw)
    sol = solve_urban(compiled, p)
    push!(ψ_road_sky, sol[compiled.Ψ_road_sky][end])
    push!(ψ_road_wall, sol[compiled.Ψ_road_wall][end])
    push!(ψ_wall_sky, sol[compiled.Ψ_wall_sky][end])
    push!(ψ_wall_road, sol[compiled.Ψ_wall_road][end])
    push!(ψ_wall_wall, sol[compiled.Ψ_wall_wall][end])
end

p = plot(hw_range, ψ_road_sky, label=&quot;Ψ_road-sky&quot;, xscale=:log10,
    xlabel=&quot;Canyon H/W Ratio&quot;, ylabel=&quot;View Factor&quot;,
    title=&quot;View Factors vs Canyon H/W Ratio (Figure 2.4)&quot;,
    linewidth=2, legend=:right, ylims=(0, 1))
plot!(p, hw_range, ψ_road_wall, label=&quot;Ψ_road-wall&quot;, linewidth=2)
plot!(p, hw_range, ψ_wall_sky, label=&quot;Ψ_wall-sky, Ψ_wall-road&quot;, linewidth=2)
plot!(p, hw_range, ψ_wall_wall, label=&quot;Ψ_wall-wall&quot;, linewidth=2)
p</code></pre><img src="1351dc60.svg" alt="Example block output"/><p>At low H/W ratios the road-sky view factor is close to one (flat surface behavior), while at high H/W ratios most radiative interactions occur between the walls and between the walls and road.</p><h3 id="Figure-2.5:-Absorbed-Solar-Radiation-vs-H/W-Ratio"><a class="docs-heading-anchor" href="#Figure-2.5:-Absorbed-Solar-Radiation-vs-H/W-Ratio">Figure 2.5: Absorbed Solar Radiation vs H/W Ratio</a><a id="Figure-2.5:-Absorbed-Solar-Radiation-vs-H/W-Ratio-1"></a><a class="docs-heading-anchor-permalink" href="#Figure-2.5:-Absorbed-Solar-Radiation-vs-H/W-Ratio" title="Permalink"></a></h3><p>Solar radiation absorbed by urban surfaces for solar zenith angles of 30 degrees (top) and 60 degrees (bottom) (cf. Figure 2.5, p. 47). The atmospheric solar radiation is <span>$S_{atm}\downarrow^{\mu} = 400$</span> and <span>$S_{atm}\downarrow = 200$</span> W m<span>$^{-2}$</span>. Albedos: roof = 0.15, road = 0.08, wall = 0.25. Note that wall fluxes are per unit wall area; the canyon total converts them to per unit ground area using the H/W ratio.</p><pre><code class="language-julia hljs">hw_range_lin = 0.1:0.1:10.0

function compute_absorbed_solar(compiled, hw_range, μ_zen)
    road = Float64[]
    sunwall = Float64[]
    shdwall = Float64[]
    roof = Float64[]
    canyon = Float64[]

    for hw in hw_range
        p = base_params(compiled; H_W=hw, μ_zen=μ_zen)
        p[compiled.S_atm_dir_vis] = 200.0
        p[compiled.S_atm_dir_nir] = 200.0
        p[compiled.S_atm_dif_vis] = 100.0
        p[compiled.S_atm_dif_nir] = 100.0
        sol = solve_urban(compiled, p)
        push!(road, sol[compiled.S_net_road][end])
        push!(sunwall, sol[compiled.S_net_sunwall][end])
        push!(shdwall, sol[compiled.S_net_shdwall][end])
        push!(roof, sol[compiled.S_net_roof][end])
        push!(canyon, sol[compiled.S_net_uc][end])
    end
    return road, sunwall, shdwall, roof, canyon
end

road30, sw30, sh30, roof30, can30 = compute_absorbed_solar(compiled, hw_range_lin, deg2rad(30))
road60, sw60, sh60, roof60, can60 = compute_absorbed_solar(compiled, hw_range_lin, deg2rad(60))

p1 = plot(hw_range_lin, can30, label=&quot;Canyon&quot;, linewidth=2,
    xlabel=&quot;Canyon H/W Ratio&quot;,
    ylabel=&quot;Absorbed Solar Radiation (W m⁻²)&quot;,
    title=&quot;Solar Zenith Angle = 30°&quot;,
    legend=:right, ylims=(0, 700))
plot!(p1, hw_range_lin, roof30, label=&quot;Roof&quot;, linewidth=2)
plot!(p1, hw_range_lin, road30, label=&quot;Road&quot;, linewidth=2)
plot!(p1, hw_range_lin, sw30, label=&quot;Sunlit Wall&quot;, linewidth=2)
plot!(p1, hw_range_lin, sh30, label=&quot;Shaded Wall&quot;, linewidth=2)

p2 = plot(hw_range_lin, can60, label=&quot;Canyon&quot;, linewidth=2,
    xlabel=&quot;Canyon H/W Ratio&quot;,
    ylabel=&quot;Absorbed Solar Radiation (W m⁻²)&quot;,
    title=&quot;Solar Zenith Angle = 60°&quot;,
    legend=:right, ylims=(0, 700))
plot!(p2, hw_range_lin, roof60, label=&quot;Roof&quot;, linewidth=2)
plot!(p2, hw_range_lin, road60, label=&quot;Road&quot;, linewidth=2)
plot!(p2, hw_range_lin, sw60, label=&quot;Sunlit Wall&quot;, linewidth=2)
plot!(p2, hw_range_lin, sh60, label=&quot;Shaded Wall&quot;, linewidth=2)

p = plot(p1, p2, layout=(2, 1), size=(700, 800))
p</code></pre><img src="cff23d2b.svg" alt="Example block output"/><p>The absorbed solar radiation for the roof is independent of H/W and solar zenith angle. At both zenith angles, absorbed road radiation decreases rapidly with increasing H/W as buildings shade the road. The canyon total increases slowly with H/W because radiation trapping in deeper canyons increases total absorption.</p><h3 id="Figure-2.6:-Canyon-Albedo-vs-H/W-Ratio"><a class="docs-heading-anchor" href="#Figure-2.6:-Canyon-Albedo-vs-H/W-Ratio">Figure 2.6: Canyon Albedo vs H/W Ratio</a><a id="Figure-2.6:-Canyon-Albedo-vs-H/W-Ratio-1"></a><a class="docs-heading-anchor-permalink" href="#Figure-2.6:-Canyon-Albedo-vs-H/W-Ratio" title="Permalink"></a></h3><p>Direct beam and diffuse canyon albedo (excluding roof) as a function of H/W ratio for solar zenith angles from 0 to 85 degrees (cf. Figure 2.6, p. 48). Albedos: road = 0.08, wall = 0.25.</p><pre><code class="language-julia hljs">hw_range_alb = 0.05:0.05:3.0
zenith_angles = 0:5:85

p = plot(xlabel=&quot;Canyon H/W Ratio&quot;, ylabel=&quot;Canyon Albedo&quot;,
    title=&quot;Canyon Albedo vs H/W Ratio (Figure 2.6)&quot;,
    legend=false, ylims=(0, 0.14))

# Direct beam albedo for each zenith angle (solid lines)
for (i, zen_deg) in enumerate(zenith_angles)
    zen_rad = deg2rad(zen_deg)
    # Avoid exactly 0 or 90 degrees
    if zen_rad &lt; 0.001
        zen_rad = 0.001
    end
    alb_dir = Float64[]
    for hw in hw_range_alb
        params = base_params(compiled; H_W=hw, μ_zen=zen_rad)
        sol = solve_urban(compiled, params)
        # Average VIS and NIR direct beam albedo
        a_vis = sol[compiled.α_uc_dir_vis][end]
        a_nir = sol[compiled.α_uc_dir_nir][end]
        push!(alb_dir, (a_vis + a_nir) / 2)
    end
    plot!(p, hw_range_alb, alb_dir, linewidth=1.5, color=:black, linestyle=:solid)
end

# Diffuse albedo (dashed line) - independent of zenith angle
alb_dif = Float64[]
for hw in hw_range_alb
    params = base_params(compiled; H_W=hw)
    sol = solve_urban(compiled, params)
    a_vis = sol[compiled.α_uc_dif_vis][end]
    a_nir = sol[compiled.α_uc_dif_nir][end]
    push!(alb_dif, (a_vis + a_nir) / 2)
end
plot!(p, hw_range_alb, alb_dif, linewidth=2, color=:black, linestyle=:dash)

# Add annotations
annotate!(p, 0.6, 0.12, text(&quot;Horizon&quot;, 8))
annotate!(p, 0.4, 0.035, text(&quot;Zenith&quot;, 8))
annotate!(p, 2.5, 0.09, text(&quot;Diffuse&quot;, 8))
annotate!(p, 2.5, 0.04, text(&quot;Direct Beam&quot;, 8))
p</code></pre><img src="443c38fe.svg" alt="Example block output"/><p>The canyon albedo generally decreases with H/W as more radiation is trapped and absorbed within deeper canyons. The trapping of solar radiation is less effective at larger solar zenith angles (near horizon), where the albedo can increase at small H/W because the higher-albedo walls dominate the radiative exchange.</p><h3 id="Figure-2.7:-Net-Longwave-Radiation-vs-H/W-Ratio"><a class="docs-heading-anchor" href="#Figure-2.7:-Net-Longwave-Radiation-vs-H/W-Ratio">Figure 2.7: Net Longwave Radiation vs H/W Ratio</a><a id="Figure-2.7:-Net-Longwave-Radiation-vs-H/W-Ratio-1"></a><a class="docs-heading-anchor-permalink" href="#Figure-2.7:-Net-Longwave-Radiation-vs-H/W-Ratio" title="Permalink"></a></h3><p>Net longwave radiation (positive toward the atmosphere) for urban surfaces with two different emissivity configurations (cf. Figure 2.7, p. 59). The atmospheric longwave radiation is <span>$L_{atm}\downarrow = 340$</span> W m<span>$^{-2}$</span> and the temperature of each surface is 292.16 K. Wall fluxes are per unit wall area.</p><pre><code class="language-julia hljs">hw_range_lw = 0.1:0.1:10.0

function compute_net_lw(compiled, hw_range; ε_roof, ε_road, ε_wall)
    road_lw = Float64[]
    wall_lw = Float64[]
    roof_lw = Float64[]
    canyon_lw = Float64[]

    for hw in hw_range
        p = base_params(compiled; H_W=hw)
        p[compiled.ε_roof] = ε_roof
        p[compiled.ε_road] = ε_road
        p[compiled.ε_wall] = ε_wall
        sol = solve_urban(compiled, p)
        push!(road_lw, sol[compiled.L_net_road][end])
        push!(wall_lw, sol[compiled.L_net_sunwall][end])  # walls equal when T equal
        push!(roof_lw, sol[compiled.L_net_roof][end])
        push!(canyon_lw, sol[compiled.L_net_uc][end])
    end
    return road_lw, wall_lw, roof_lw, canyon_lw
end

road1, wall1, roof1, can1 = compute_net_lw(compiled, hw_range_lw;
    ε_roof=0.95, ε_road=0.95, ε_wall=0.95)
road2, wall2, roof2, can2 = compute_net_lw(compiled, hw_range_lw;
    ε_roof=0.90, ε_road=0.94, ε_wall=0.85)

p1 = plot(hw_range_lw, can1, label=&quot;Canyon&quot;, linewidth=2,
    xlabel=&quot;Canyon H/W Ratio&quot;,
    ylabel=&quot;Net Longwave Radiation (W m⁻²)&quot;,
    title=&quot;Emissivity: Roof=0.95, Road=0.95, Wall=0.95&quot;,
    legend=:right, ylims=(0, 80))
plot!(p1, hw_range_lw, roof1, label=&quot;Roof&quot;, linewidth=2)
plot!(p1, hw_range_lw, road1, label=&quot;Road&quot;, linewidth=2)
plot!(p1, hw_range_lw, wall1, label=&quot;Walls&quot;, linewidth=2)

p2 = plot(hw_range_lw, can2, label=&quot;Canyon&quot;, linewidth=2,
    xlabel=&quot;Canyon H/W Ratio&quot;,
    ylabel=&quot;Net Longwave Radiation (W m⁻²)&quot;,
    title=&quot;Emissivity: Roof=0.90, Road=0.94, Wall=0.85&quot;,
    legend=:right, ylims=(0, 80))
plot!(p2, hw_range_lw, roof2, label=&quot;Roof&quot;, linewidth=2)
plot!(p2, hw_range_lw, road2, label=&quot;Road&quot;, linewidth=2)
plot!(p2, hw_range_lw, wall2, label=&quot;Walls&quot;, linewidth=2)

p = plot(p1, p2, layout=(2, 1), size=(700, 800))
p</code></pre><img src="506405fe.svg" alt="Example block output"/><p>The net longwave radiation for the roof is independent of H/W and increases with higher emissivity. The net longwave for road and walls decreases rapidly with increasing H/W as more radiation is trapped within the canyon. The walls have lower net longwave than the road because their sky view factors are smaller. The canyon net longwave (sum of road and wall fluxes converted to per unit ground area) increases slowly with H/W because of the larger surface area of the walls.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../clmu_introduction/">« CLMU Introduction</a><a class="docs-footer-nextpage" href="../api/">API »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.16.1 on <span class="colophon-date" title="Saturday 7 February 2026 13:59">Saturday 7 February 2026</span>. Using Julia version 1.12.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
