<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Offline Mode · UrbanCanopy.jl</title><meta name="title" content="Offline Mode · UrbanCanopy.jl"/><meta property="og:title" content="Offline Mode · UrbanCanopy.jl"/><meta property="twitter:title" content="Offline Mode · UrbanCanopy.jl"/><meta name="description" content="Documentation for UrbanCanopy.jl."/><meta property="og:description" content="Documentation for UrbanCanopy.jl."/><meta property="twitter:description" content="Documentation for UrbanCanopy.jl."/><meta property="og:url" content="https://urbancanopy.earthsci.dev/offline_mode/"/><meta property="twitter:url" content="https://urbancanopy.earthsci.dev/offline_mode/"/><link rel="canonical" href="https://urbancanopy.earthsci.dev/offline_mode/"/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">UrbanCanopy.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../clmu_introduction/">CLMU Introduction</a></li><li class="is-active"><a class="tocitem" href>Offline Mode</a><ul class="internal"><li><a class="tocitem" href="#Overview"><span>Overview</span></a></li><li><a class="tocitem" href="#Implementation"><span>Implementation</span></a></li><li><a class="tocitem" href="#Analysis"><span>Analysis</span></a></li></ul></li><li><a class="tocitem" href="../albedos_radiative_fluxes/">Albedos and Radiative Fluxes</a></li><li><a class="tocitem" href="../heat_momentum_fluxes/">Heat and Momentum Fluxes</a></li><li><a class="tocitem" href="../roof_wall_road_snow_temperatures/">Roof, Wall, Road, Snow Temperatures</a></li><li><a class="tocitem" href="../hydrology/">Hydrology</a></li><li><a class="tocitem" href="../api/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Offline Mode</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Offline Mode</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/EarthSciML/UrbanCanopy.jl/blob/main/docs/src/offline_mode.md#" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Offline-Mode:-Atmospheric-Forcing"><a class="docs-heading-anchor" href="#Offline-Mode:-Atmospheric-Forcing">Offline Mode: Atmospheric Forcing</a><a id="Offline-Mode:-Atmospheric-Forcing-1"></a><a class="docs-heading-anchor-permalink" href="#Offline-Mode:-Atmospheric-Forcing" title="Permalink"></a></h1><h2 id="Overview"><a class="docs-heading-anchor" href="#Overview">Overview</a><a id="Overview-1"></a><a class="docs-heading-anchor-permalink" href="#Overview" title="Permalink"></a></h2><p>In offline mode (uncoupled from an atmospheric model), the Community Land Model Urban (CLMU) requires atmospheric forcing data from observed datasets. Chapter 6 of the technical note describes how raw forcing data is processed into the specific variables needed by the urban model.</p><p>The <code>OfflineModeForcing</code> component implements the algebraic relationships for:</p><ul><li>Partitioning total solar radiation into direct/diffuse and visible/near-infrared components (Eqs. 6.2-6.8) using polynomial fits derived from CAM output</li><li>Computing atmospheric downwelling longwave radiation from vapor pressure and temperature using the Idso (1981) formula (Eqs. 6.9-6.10)</li><li>Partitioning precipitation into rain and snow based on temperature (Eqs. 6.11-6.13)</li><li>Deriving wind components, potential temperature, and reference height (p. 149)</li></ul><p><strong>Reference</strong>: Oleson, K.W., G.B. Bonan, J.J. Feddema, M. Vertenstein, and E. Kluzek, 2010: Technical Description of an Urban Parameterization for the Community Land Model (CLMU). NCAR Technical Note NCAR/TN-480+STR, National Center for Atmospheric Research, Boulder, CO, 168 pp.</p><article><details class="docstring" open="true"><summary id="UrbanCanopy.OfflineModeForcing"><a class="docstring-binding" href="#UrbanCanopy.OfflineModeForcing"><code>UrbanCanopy.OfflineModeForcing</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">OfflineModeForcing(; name=:OfflineModeForcing)</code></pre><p>Offline mode atmospheric forcing processor for the Community Land Model Urban (CLMU). Computes derived atmospheric forcing variables from raw observational data for use in uncoupled (offline) simulations, following Chapter 6 of Oleson et al. (2010).</p><p>This component takes total incident solar radiation, cosine of solar zenith angle, atmospheric temperature, pressure, specific humidity, wind speed, and precipitation rate as inputs and computes:</p><ul><li>Solar radiation partitioned into direct/diffuse and visible/near-infrared components (Eqs. 6.2-6.8)</li><li>Atmospheric downwelling longwave radiation from the Idso (1981) formula (Eqs. 6.9-6.10)</li><li>Rain and snow precipitation rates from temperature-dependent partitioning (Eqs. 6.11-6.13)</li><li>Wind components, potential temperature, and reference height (p.149)</li></ul><p><strong>Note</strong>: Equation 6.1 describes temporal downscaling of 6-hourly solar radiation to model time steps using cosine of solar zenith angle weighting. This discrete-time algorithm is a data preprocessing step and is not implemented here; instead, <code>S_atm</code> is taken as the already-interpolated total solar radiation at the model time step.</p><p><strong>Note</strong>: Equations 6.14-6.15 describe alternative methods for computing specific humidity from relative humidity or dew point temperature. These are optional data preprocessing steps and are not implemented in this component.</p><p><strong>Reference</strong>: Oleson, K.W., G.B. Bonan, J.J. Feddema, M. Vertenstein, and E. Kluzek, 2010: Technical Description of an Urban Parameterization for the Community Land Model (CLMU). NCAR Technical Note NCAR/TN-480+STR, National Center for Atmospheric Research, Boulder, CO, 168 pp.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/EarthSciML/UrbanCanopy.jl/blob/adb61d4e83c8d3195178d8d7898c9842eb217f02/src/offline_mode.jl#L3-L32">source</a></section></details></article><h2 id="Implementation"><a class="docs-heading-anchor" href="#Implementation">Implementation</a><a id="Implementation-1"></a><a class="docs-heading-anchor-permalink" href="#Implementation" title="Permalink"></a></h2><h3 id="State-Variables"><a class="docs-heading-anchor" href="#State-Variables">State Variables</a><a id="State-Variables-1"></a><a class="docs-heading-anchor-permalink" href="#State-Variables" title="Permalink"></a></h3><pre><code class="language-julia hljs">using DataFrames, ModelingToolkit, Symbolics, DynamicQuantities
using UrbanCanopy

sys = OfflineModeForcing()

vars = unknowns(sys)
DataFrame(
    :Name =&gt; [string(Symbolics.tosymbol(v, escape = false)) for v in vars],
    :Units =&gt; [dimension(ModelingToolkit.get_unit(v)) for v in vars],
    :Description =&gt; [ModelingToolkit.getdescription(v) for v in vars]
)</code></pre><div><div style = "float: left;"><span>18×3 DataFrame</span></div><div style = "clear: both;"></div></div><div class = "data-frame" style = "overflow-x: scroll;"><table class = "data-frame" style = "margin-bottom: 6px;"><thead><tr class = "columnLabelRow"><th class = "stubheadLabel" style = "font-weight: bold; text-align: right;">Row</th><th style = "text-align: left;">Name</th><th style = "text-align: left;">Units</th><th style = "text-align: left;">Description</th></tr><tr class = "columnLabelRow"><th class = "stubheadLabel" style = "font-weight: bold; text-align: right;"></th><th title = "String" style = "text-align: left;">String</th><th title = "DynamicQuantities.Dimensions{DynamicQuantities.FRInt32}" style = "text-align: left;">Dimensio…</th><th title = "String" style = "text-align: left;">String</th></tr></thead><tbody><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">1</td><td style = "text-align: left;">R_vis_raw</td><td style = "text-align: left;"></td><td style = "text-align: left;">Unclamped visible direct fraction (Eq. 6.7) (dimensionless)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">2</td><td style = "text-align: left;">R_nir_raw</td><td style = "text-align: left;"></td><td style = "text-align: left;">Unclamped NIR direct fraction (Eq. 6.8) (dimensionless)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">3</td><td style = "text-align: left;">R_vis</td><td style = "text-align: left;"></td><td style = "text-align: left;">Visible direct fraction, clamped to [0.01, 0.99] (Eq. 6.7) (dimensionless)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">4</td><td style = "text-align: left;">R_nir</td><td style = "text-align: left;"></td><td style = "text-align: left;">NIR direct fraction, clamped to [0.01, 0.99] (Eq. 6.8) (dimensionless)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">5</td><td style = "text-align: left;">S_atm_dir_vis</td><td style = "text-align: left;">kg s⁻³</td><td style = "text-align: left;">Direct beam visible solar radiation (Eq. 6.2)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">6</td><td style = "text-align: left;">S_atm_dir_nir</td><td style = "text-align: left;">kg s⁻³</td><td style = "text-align: left;">Direct beam near-infrared solar radiation (Eq. 6.3)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">7</td><td style = "text-align: left;">S_atm_dif_vis</td><td style = "text-align: left;">kg s⁻³</td><td style = "text-align: left;">Diffuse visible solar radiation (Eq. 6.4)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">8</td><td style = "text-align: left;">S_atm_dif_nir</td><td style = "text-align: left;">kg s⁻³</td><td style = "text-align: left;">Diffuse near-infrared solar radiation (Eq. 6.5)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">9</td><td style = "text-align: left;">e_atm</td><td style = "text-align: left;">m⁻¹ kg s⁻²</td><td style = "text-align: left;">Atmospheric vapor pressure (Eq. 6.10)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">10</td><td style = "text-align: left;">L_atm_down</td><td style = "text-align: left;">kg s⁻³</td><td style = "text-align: left;">Atmospheric downwelling longwave radiation (Eq. 6.9)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">11</td><td style = "text-align: left;">f_P_raw</td><td style = "text-align: left;"></td><td style = "text-align: left;">Unclamped rain fraction (Eq. 6.13) (dimensionless)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">12</td><td style = "text-align: left;">f_P</td><td style = "text-align: left;"></td><td style = "text-align: left;">Rain fraction, clamped to [0, 1] (Eq. 6.13) (dimensionless)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">13</td><td style = "text-align: left;">q_rain</td><td style = "text-align: left;">m⁻² kg s⁻¹</td><td style = "text-align: left;">Liquid precipitation rate (Eq. 6.11)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">14</td><td style = "text-align: left;">q_snow</td><td style = "text-align: left;">m⁻² kg s⁻¹</td><td style = "text-align: left;">Solid precipitation rate (Eq. 6.12)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">15</td><td style = "text-align: left;">u_atm</td><td style = "text-align: left;">m s⁻¹</td><td style = "text-align: left;">Zonal wind component (p.149)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">16</td><td style = "text-align: left;">v_atm</td><td style = "text-align: left;">m s⁻¹</td><td style = "text-align: left;">Meridional wind component (p.149)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">17</td><td style = "text-align: left;">θ_atm</td><td style = "text-align: left;">K</td><td style = "text-align: left;">Potential temperature (p.149)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">18</td><td style = "text-align: left;">z_prime_atm</td><td style = "text-align: left;">m</td><td style = "text-align: left;">Atmospheric reference height (p.149)</td></tr></tbody></table></div><h3 id="Parameters"><a class="docs-heading-anchor" href="#Parameters">Parameters</a><a id="Parameters-1"></a><a class="docs-heading-anchor-permalink" href="#Parameters" title="Permalink"></a></h3><pre><code class="language-julia hljs">params = parameters(sys)
DataFrame(
    :Name =&gt; [string(Symbolics.tosymbol(p, escape = false)) for p in params],
    :Units =&gt; [dimension(ModelingToolkit.get_unit(p)) for p in params],
    :Description =&gt; [ModelingToolkit.getdescription(p) for p in params]
)</code></pre><div><div style = "float: left;"><span>31×3 DataFrame</span></div><div style = "clear: both;"></div></div><div class = "data-frame" style = "overflow-x: scroll;"><table class = "data-frame" style = "margin-bottom: 6px;"><thead><tr class = "columnLabelRow"><th class = "stubheadLabel" style = "font-weight: bold; text-align: right;">Row</th><th style = "text-align: left;">Name</th><th style = "text-align: left;">Units</th><th style = "text-align: left;">Description</th></tr><tr class = "columnLabelRow"><th class = "stubheadLabel" style = "font-weight: bold; text-align: right;"></th><th title = "String" style = "text-align: left;">String</th><th title = "DynamicQuantities.Dimensions{DynamicQuantities.FRInt32}" style = "text-align: left;">Dimensio…</th><th title = "String" style = "text-align: left;">String</th></tr></thead><tbody><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">1</td><td style = "text-align: left;">zero_dimless</td><td style = "text-align: left;"></td><td style = "text-align: left;">Zero (dimensionless)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">2</td><td style = "text-align: left;">b_0</td><td style = "text-align: left;"></td><td style = "text-align: left;">NIR direct fraction polynomial coefficient b_0 (Eq. 6.8) (dimensionless)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">3</td><td style = "text-align: left;">P_precip</td><td style = "text-align: left;">m⁻² kg s⁻¹</td><td style = "text-align: left;">Total precipitation rate</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">4</td><td style = "text-align: left;">W_atm</td><td style = "text-align: left;">m s⁻¹</td><td style = "text-align: left;">Atmospheric wind speed</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">5</td><td style = "text-align: left;">P_atm</td><td style = "text-align: left;">m⁻¹ kg s⁻²</td><td style = "text-align: left;">Atmospheric pressure</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">6</td><td style = "text-align: left;">idso_coeff</td><td style = "text-align: left;">m kg⁻¹ s²</td><td style = "text-align: left;">Idso vapor pressure coefficient 5.95e-5 * 0.01 (Eq. 6.9)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">7</td><td style = "text-align: left;">MW_wv</td><td style = "text-align: left;">kg mol⁻¹</td><td style = "text-align: left;">Molecular weight of water vapor (Table 1.4)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">8</td><td style = "text-align: left;">a_0</td><td style = "text-align: left;"></td><td style = "text-align: left;">Visible direct fraction polynomial coefficient a_0 (Eq. 6.7) (dimensionless)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">9</td><td style = "text-align: left;">a_2</td><td style = "text-align: left;">kg⁻² s⁶</td><td style = "text-align: left;">Visible direct fraction polynomial coefficient a_2 (Eq. 6.7)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">10</td><td style = "text-align: left;">b_3</td><td style = "text-align: left;">kg⁻³ s⁹</td><td style = "text-align: left;">NIR direct fraction polynomial coefficient b_3 (Eq. 6.8)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">11</td><td style = "text-align: left;">ε_ratio</td><td style = "text-align: left;"></td><td style = "text-align: left;">Ratio of molecular weights MW_wv/MW_da = 0.622 (dimensionless)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">12</td><td style = "text-align: left;">idso_base</td><td style = "text-align: left;"></td><td style = "text-align: left;">Idso base emissivity factor (Eq. 6.9) (dimensionless)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">13</td><td style = "text-align: left;">S_atm</td><td style = "text-align: left;">kg s⁻³</td><td style = "text-align: left;">Total incident solar radiation at model time step (Eq. 6.1 output)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">14</td><td style = "text-align: left;">b_2</td><td style = "text-align: left;">kg⁻² s⁶</td><td style = "text-align: left;">NIR direct fraction polynomial coefficient b_2 (Eq. 6.8)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">15</td><td style = "text-align: left;">a_1</td><td style = "text-align: left;">kg⁻¹ s³</td><td style = "text-align: left;">Visible direct fraction polynomial coefficient a_1 (Eq. 6.7)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">16</td><td style = "text-align: left;">one_minus_ε</td><td style = "text-align: left;"></td><td style = "text-align: left;">1 - MW_wv/MW_da = 0.378 (dimensionless)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">17</td><td style = "text-align: left;">T_f</td><td style = "text-align: left;">K</td><td style = "text-align: left;">Freezing temperature of water (Table 1.4)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">18</td><td style = "text-align: left;">q_atm</td><td style = "text-align: left;"></td><td style = "text-align: left;">Atmospheric specific humidity</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">19</td><td style = "text-align: left;">b_1</td><td style = "text-align: left;">kg⁻¹ s³</td><td style = "text-align: left;">NIR direct fraction polynomial coefficient b_1 (Eq. 6.8)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">20</td><td style = "text-align: left;">a_3</td><td style = "text-align: left;">kg⁻³ s⁹</td><td style = "text-align: left;">Visible direct fraction polynomial coefficient a_3 (Eq. 6.7)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">21</td><td style = "text-align: left;">idso_T_ref</td><td style = "text-align: left;">K</td><td style = "text-align: left;">Idso temperature reference (Eq. 6.9)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">22</td><td style = "text-align: left;">z_prime_atm_val</td><td style = "text-align: left;">m</td><td style = "text-align: left;">Atmospheric reference height (p.149)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">23</td><td style = "text-align: left;">R_max</td><td style = "text-align: left;"></td><td style = "text-align: left;">Maximum direct fraction (Eqs. 6.7-6.8) (dimensionless)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">24</td><td style = "text-align: left;">MW_da</td><td style = "text-align: left;">kg mol⁻¹</td><td style = "text-align: left;">Molecular weight of dry air (Table 1.4)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">25</td><td style = "text-align: left;">α_vis</td><td style = "text-align: left;"></td><td style = "text-align: left;">Ratio of visible to total incident solar radiation (Eq. 6.6) (dimensionless)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">26</td><td style = "text-align: left;">R_min</td><td style = "text-align: left;"></td><td style = "text-align: left;">Minimum direct fraction (Eqs. 6.7-6.8) (dimensionless)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">27</td><td style = "text-align: left;">T_atm</td><td style = "text-align: left;">K</td><td style = "text-align: left;">Atmospheric temperature</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">28</td><td style = "text-align: left;">σ_SB</td><td style = "text-align: left;">kg s⁻³ K⁻⁴</td><td style = "text-align: left;">Stefan-Boltzmann constant (Table 1.4)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">29</td><td style = "text-align: left;">one_dimless</td><td style = "text-align: left;"></td><td style = "text-align: left;">One (dimensionless)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">30</td><td style = "text-align: left;">f_P_slope</td><td style = "text-align: left;">K⁻¹</td><td style = "text-align: left;">Rain fraction slope (Eq. 6.13)</td></tr><tr class = "dataRow"><td class = "rowLabel" style = "font-weight: bold; text-align: right;">31</td><td style = "text-align: left;">sqrt2_inv</td><td style = "text-align: left;"></td><td style = "text-align: left;">1/√2 for wind decomposition (dimensionless)</td></tr></tbody></table></div><h3 id="Equations"><a class="docs-heading-anchor" href="#Equations">Equations</a><a id="Equations-1"></a><a class="docs-heading-anchor-permalink" href="#Equations" title="Permalink"></a></h3><pre><code class="language-julia hljs">eqs = equations(sys)</code></pre><p class="math-container">\[ \begin{align}
\mathtt{R\_vis\_raw}\left( t \right) &amp;= \mathtt{a\_0} + \mathtt{S\_atm} \mathtt{a\_1} \mathtt{\alpha\_vis} + \mathtt{\alpha\_vis}^{2} \mathtt{S\_atm}^{2} \mathtt{a\_2} + \mathtt{\alpha\_vis}^{3} \mathtt{S\_atm}^{3} \mathtt{a\_3} \\
\mathtt{R\_nir\_raw}\left( t \right) &amp;= \mathtt{b\_0} + \mathtt{S\_atm} \mathtt{b\_1} \left( \mathtt{one\_dimless} - \mathtt{\alpha\_vis} \right) + \left( \mathtt{one\_dimless} - \mathtt{\alpha\_vis} \right)^{2} \mathtt{S\_atm}^{2} \mathtt{b\_2} + \left( \mathtt{one\_dimless} - \mathtt{\alpha\_vis} \right)^{3} \mathtt{S\_atm}^{3} \mathtt{b\_3} \\
\mathtt{R\_vis}\left( t \right) &amp;= max\left( \mathtt{R\_min}, min\left( \mathtt{R\_max}, \mathtt{R\_vis\_raw}\left( t \right) \right) \right) \\
\mathtt{R\_nir}\left( t \right) &amp;= max\left( \mathtt{R\_min}, min\left( \mathtt{R\_max}, \mathtt{R\_nir\_raw}\left( t \right) \right) \right) \\
\mathtt{S\_atm\_dir\_vis}\left( t \right) &amp;= \mathtt{S\_atm} \mathtt{R\_vis}\left( t \right) \mathtt{\alpha\_vis} \\
\mathtt{S\_atm\_dir\_nir}\left( t \right) &amp;= \mathtt{S\_atm} \left( \mathtt{one\_dimless} - \mathtt{\alpha\_vis} \right) \mathtt{R\_nir}\left( t \right) \\
\mathtt{S\_atm\_dif\_vis}\left( t \right) &amp;= \mathtt{S\_atm} \left( \mathtt{one\_dimless} - \mathtt{R\_vis}\left( t \right) \right) \mathtt{\alpha\_vis} \\
\mathtt{S\_atm\_dif\_nir}\left( t \right) &amp;= \mathtt{S\_atm} \left( \mathtt{one\_dimless} - \mathtt{\alpha\_vis} \right) \left( \mathtt{one\_dimless} - \mathtt{R\_nir}\left( t \right) \right) \\
\mathtt{e\_atm}\left( t \right) &amp;= \frac{\mathtt{P\_atm} \mathtt{q\_atm}}{\mathtt{\varepsilon\_ratio} + \mathtt{one\_minus\_\varepsilon} \mathtt{q\_atm}} \\
\mathtt{L\_atm\_down}\left( t \right) &amp;= \mathtt{T\_atm}^{4} \left( \mathtt{idso\_base} + \mathtt{idso\_coeff} e^{\frac{\mathtt{idso\_T\_ref}}{\mathtt{T\_atm}}} \mathtt{e\_atm}\left( t \right) \right) \mathtt{\sigma\_SB} \\
\mathtt{f\_P\_raw}\left( t \right) &amp;= \left( \mathtt{T\_atm} - \mathtt{T\_f} \right) \mathtt{f\_P\_slope} \\
\mathtt{f\_P}\left( t \right) &amp;= max\left( \mathtt{zero\_dimless}, min\left( \mathtt{one\_dimless}, \mathtt{f\_P\_raw}\left( t \right) \right) \right) \\
\mathtt{q\_rain}\left( t \right) &amp;= \mathtt{P\_precip} \mathtt{f\_P}\left( t \right) \\
\mathtt{q\_snow}\left( t \right) &amp;= \mathtt{P\_precip} \left( \mathtt{one\_dimless} - \mathtt{f\_P}\left( t \right) \right) \\
\mathtt{u\_atm}\left( t \right) &amp;= \mathtt{W\_atm} \mathtt{sqrt2\_inv} \\
\mathtt{v\_atm}\left( t \right) &amp;= \mathtt{W\_atm} \mathtt{sqrt2\_inv} \\
\mathtt{\theta\_atm}\left( t \right) &amp;= \mathtt{T\_atm} \\
\mathtt{z\_prime\_atm}\left( t \right) &amp;= \mathtt{z\_prime\_atm\_val}
\end{align}
 \]</p><h2 id="Analysis"><a class="docs-heading-anchor" href="#Analysis">Analysis</a><a id="Analysis-1"></a><a class="docs-heading-anchor-permalink" href="#Analysis" title="Permalink"></a></h2><h3 id="Solar-Radiation-Partitioning-(Eqs.-6.2-6.8)"><a class="docs-heading-anchor" href="#Solar-Radiation-Partitioning-(Eqs.-6.2-6.8)">Solar Radiation Partitioning (Eqs. 6.2-6.8)</a><a id="Solar-Radiation-Partitioning-(Eqs.-6.2-6.8)-1"></a><a class="docs-heading-anchor-permalink" href="#Solar-Radiation-Partitioning-(Eqs.-6.2-6.8)" title="Permalink"></a></h3><p>The total incident solar radiation is split into four components: direct beam visible, direct beam near-infrared, diffuse visible, and diffuse near-infrared. The visible fraction <span>$\alpha = 0.5$</span> (Eq. 6.6), and the direct-to-total ratios <span>$R_{vis}$</span> and <span>$R_{nir}$</span> are polynomial functions of the solar flux (Eqs. 6.7-6.8), clamped to [0.01, 0.99].</p><pre><code class="language-julia hljs">using OrdinaryDiffEqDefault
using Plots

compiled = mtkcompile(sys)

S_range = 0.0:10.0:1200.0
dir_vis = Float64[]
dir_nir = Float64[]
dif_vis = Float64[]
dif_nir = Float64[]

for S_val in S_range
    prob = ODEProblem(
        compiled,
        Dict(
            compiled.S_atm =&gt; S_val,
            compiled.T_atm =&gt; 293.15,
            compiled.P_atm =&gt; 101325.0,
            compiled.q_atm =&gt; 0.01,
            compiled.W_atm =&gt; 5.0,
            compiled.P_precip =&gt; 0.0,
        ),
        (0.0, 1.0),
    )
    sol = solve(prob)
    push!(dir_vis, sol[compiled.S_atm_dir_vis][end])
    push!(dir_nir, sol[compiled.S_atm_dir_nir][end])
    push!(dif_vis, sol[compiled.S_atm_dif_vis][end])
    push!(dif_nir, sol[compiled.S_atm_dif_nir][end])
end

p = plot(S_range, dir_vis, label=&quot;Direct visible&quot;, xlabel=&quot;Total solar radiation (W/m²)&quot;,
    ylabel=&quot;Component radiation (W/m²)&quot;,
    title=&quot;Solar Radiation Partitioning (Eqs. 6.2-6.5)&quot;,
    linewidth=2, legend=:topleft)
plot!(p, S_range, dir_nir, label=&quot;Direct NIR&quot;, linewidth=2)
plot!(p, S_range, dif_vis, label=&quot;Diffuse visible&quot;, linewidth=2, linestyle=:dash)
plot!(p, S_range, dif_nir, label=&quot;Diffuse NIR&quot;, linewidth=2, linestyle=:dash)
p</code></pre><img src="daf0e8d1.svg" alt="Example block output"/><p>At low solar radiation (overcast), the diffuse fraction dominates. As total solar radiation increases (clearer skies), the direct beam fraction increases, consistent with less atmospheric scattering under clear conditions.</p><h3 id="Direct-Fraction-vs.-Solar-Flux-(Eqs.-6.7-6.8)"><a class="docs-heading-anchor" href="#Direct-Fraction-vs.-Solar-Flux-(Eqs.-6.7-6.8)">Direct Fraction vs. Solar Flux (Eqs. 6.7-6.8)</a><a id="Direct-Fraction-vs.-Solar-Flux-(Eqs.-6.7-6.8)-1"></a><a class="docs-heading-anchor-permalink" href="#Direct-Fraction-vs.-Solar-Flux-(Eqs.-6.7-6.8)" title="Permalink"></a></h3><p>The polynomial fits for <span>$R_{vis}$</span> and <span>$R_{nir}$</span> show how the direct-to-total radiation ratio varies with solar intensity.</p><pre><code class="language-julia hljs">R_vis_vals = Float64[]
R_nir_vals = Float64[]

for S_val in S_range
    prob = ODEProblem(
        compiled,
        Dict(
            compiled.S_atm =&gt; S_val,
            compiled.T_atm =&gt; 293.15,
            compiled.P_atm =&gt; 101325.0,
            compiled.q_atm =&gt; 0.01,
            compiled.W_atm =&gt; 5.0,
            compiled.P_precip =&gt; 0.0,
        ),
        (0.0, 1.0),
    )
    sol = solve(prob)
    push!(R_vis_vals, sol[compiled.R_vis][end])
    push!(R_nir_vals, sol[compiled.R_nir][end])
end

p = plot(S_range, R_vis_vals, label=&quot;R_vis (visible)&quot;, xlabel=&quot;Total solar radiation (W/m²)&quot;,
    ylabel=&quot;Direct fraction (dimensionless)&quot;,
    title=&quot;Direct-to-Total Radiation Ratio (Eqs. 6.7-6.8)&quot;,
    linewidth=2, legend=:right, ylims=(0, 1))
plot!(p, S_range, R_nir_vals, label=&quot;R_nir (NIR)&quot;, linewidth=2)
hline!(p, [0.01, 0.99], label=&quot;Clamp bounds&quot;, linestyle=:dot, color=:gray)
p</code></pre><img src="16204331.svg" alt="Example block output"/><p>The near-infrared direct fraction is consistently higher than the visible direct fraction, reflecting the greater atmospheric scattering of shorter (visible) wavelengths relative to longer (NIR) wavelengths.</p><h3 id="Longwave-Radiation-vs.-Temperature-(Eq.-6.9)"><a class="docs-heading-anchor" href="#Longwave-Radiation-vs.-Temperature-(Eq.-6.9)">Longwave Radiation vs. Temperature (Eq. 6.9)</a><a id="Longwave-Radiation-vs.-Temperature-(Eq.-6.9)-1"></a><a class="docs-heading-anchor-permalink" href="#Longwave-Radiation-vs.-Temperature-(Eq.-6.9)" title="Permalink"></a></h3><p>The Idso (1981) formula computes atmospheric downwelling longwave radiation from vapor pressure and temperature. The dominant dependence is on <span>$T_{atm}^4$</span> through the Stefan-Boltzmann law, modulated by an emissivity factor that increases with atmospheric moisture.</p><pre><code class="language-julia hljs">T_range = 250.0:2.0:320.0
L_dry = Float64[]
L_moist = Float64[]

for T_val in T_range
    prob_d = ODEProblem(
        compiled,
        Dict(
            compiled.S_atm =&gt; 0.0,
            compiled.T_atm =&gt; T_val,
            compiled.P_atm =&gt; 101325.0,
            compiled.q_atm =&gt; 0.001,
            compiled.W_atm =&gt; 5.0,
            compiled.P_precip =&gt; 0.0,
        ),
        (0.0, 1.0),
    )
    sol_d = solve(prob_d)
    push!(L_dry, sol_d[compiled.L_atm_down][end])

    prob_m = ODEProblem(
        compiled,
        Dict(
            compiled.S_atm =&gt; 0.0,
            compiled.T_atm =&gt; T_val,
            compiled.P_atm =&gt; 101325.0,
            compiled.q_atm =&gt; 0.02,
            compiled.W_atm =&gt; 5.0,
            compiled.P_precip =&gt; 0.0,
        ),
        (0.0, 1.0),
    )
    sol_m = solve(prob_m)
    push!(L_moist, sol_m[compiled.L_atm_down][end])
end

p = plot(T_range, L_dry, label=&quot;Dry (q=0.001 kg/kg)&quot;, xlabel=&quot;Temperature (K)&quot;,
    ylabel=&quot;Longwave radiation (W/m²)&quot;,
    title=&quot;Atmospheric Downwelling Longwave (Eq. 6.9, Idso 1981)&quot;,
    linewidth=2, legend=:topleft)
plot!(p, T_range, L_moist, label=&quot;Moist (q=0.02 kg/kg)&quot;, linewidth=2, linestyle=:dash)
p</code></pre><img src="6ff5ae4b.svg" alt="Example block output"/><p>Higher atmospheric moisture content increases the effective emissivity of the atmosphere, resulting in greater downwelling longwave radiation at all temperatures.</p><h3 id="Precipitation-Phase-Partitioning-(Eqs.-6.11-6.13)"><a class="docs-heading-anchor" href="#Precipitation-Phase-Partitioning-(Eqs.-6.11-6.13)">Precipitation Phase Partitioning (Eqs. 6.11-6.13)</a><a id="Precipitation-Phase-Partitioning-(Eqs.-6.11-6.13)-1"></a><a class="docs-heading-anchor-permalink" href="#Precipitation-Phase-Partitioning-(Eqs.-6.11-6.13)" title="Permalink"></a></h3><p>The rain fraction <span>$f_P$</span> varies linearly from 0 (all snow) at or below the freezing point <span>$T_f = 273.15$</span> K to 1 (all rain) at <span>$T_f + 2$</span> K. This simple linear ramp avoids an abrupt transition between rain and snow.</p><pre><code class="language-julia hljs">T_precip_range = 268.0:0.1:280.0
f_P_vals = Float64[]
rain_vals = Float64[]
snow_vals = Float64[]
P_val = 1e-3  # 1 mm/s

for T_val in T_precip_range
    prob = ODEProblem(
        compiled,
        Dict(
            compiled.S_atm =&gt; 0.0,
            compiled.T_atm =&gt; T_val,
            compiled.P_atm =&gt; 101325.0,
            compiled.q_atm =&gt; 0.005,
            compiled.W_atm =&gt; 3.0,
            compiled.P_precip =&gt; P_val,
        ),
        (0.0, 1.0),
    )
    sol = solve(prob)
    push!(f_P_vals, sol[compiled.f_P][end])
    push!(rain_vals, sol[compiled.q_rain][end])
    push!(snow_vals, sol[compiled.q_snow][end])
end

p = plot(T_precip_range .- 273.15, f_P_vals,
    label=&quot;Rain fraction f_P&quot;, xlabel=&quot;Temperature (°C)&quot;,
    ylabel=&quot;Fraction / Rate (mm/s)&quot;,
    title=&quot;Precipitation Phase Partitioning (Eqs. 6.11-6.13)&quot;,
    linewidth=2, legend=:right)
plot!(p, T_precip_range .- 273.15, rain_vals .* 1000,
    label=&quot;Rain rate (mm/s)&quot;, linewidth=2, linestyle=:dash)
plot!(p, T_precip_range .- 273.15, snow_vals .* 1000,
    label=&quot;Snow rate (mm/s)&quot;, linewidth=2, linestyle=:dot)
vline!(p, [0.0, 2.0], label=&quot;Transition range&quot;, linestyle=:dot, color=:gray)
p</code></pre><img src="beb5561c.svg" alt="Example block output"/><p>The transition zone spans 0°C to 2°C. Below 0°C, all precipitation falls as snow; above 2°C, all precipitation falls as rain. Between these limits, a mixture of rain and snow occurs with the rain fraction <span>$f_P = 0.5(T_{atm} - T_f)$</span> (Eq. 6.13).</p><h3 id="Energy-Conservation-Check"><a class="docs-heading-anchor" href="#Energy-Conservation-Check">Energy Conservation Check</a><a id="Energy-Conservation-Check-1"></a><a class="docs-heading-anchor-permalink" href="#Energy-Conservation-Check" title="Permalink"></a></h3><p>A key validation of the solar radiation partitioning is that the sum of all four components equals the total input solar radiation for all values of <span>$S_{atm}$</span>.</p><pre><code class="language-julia hljs">total_check = Float64[]

for S_val in S_range
    prob = ODEProblem(
        compiled,
        Dict(
            compiled.S_atm =&gt; S_val,
            compiled.T_atm =&gt; 293.15,
            compiled.P_atm =&gt; 101325.0,
            compiled.q_atm =&gt; 0.01,
            compiled.W_atm =&gt; 5.0,
            compiled.P_precip =&gt; 0.0,
        ),
        (0.0, 1.0),
    )
    sol = solve(prob)
    total = sol[compiled.S_atm_dir_vis][end] + sol[compiled.S_atm_dir_nir][end] +
            sol[compiled.S_atm_dif_vis][end] + sol[compiled.S_atm_dif_nir][end]
    push!(total_check, total - S_val)
end

p = plot(S_range, total_check, xlabel=&quot;Total solar radiation (W/m²)&quot;,
    ylabel=&quot;Residual (W/m²)&quot;,
    title=&quot;Energy Conservation: Sum of Components - Total&quot;,
    linewidth=2, legend=false)
p</code></pre><img src="df27ba23.svg" alt="Example block output"/><p>The residual is effectively zero (machine precision) across the full range of solar radiation values, confirming exact energy conservation in the partitioning scheme.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../clmu_introduction/">« CLMU Introduction</a><a class="docs-footer-nextpage" href="../albedos_radiative_fluxes/">Albedos and Radiative Fluxes »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.16.1 on <span class="colophon-date" title="Thursday 12 February 2026 20:51">Thursday 12 February 2026</span>. Using Julia version 1.12.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
